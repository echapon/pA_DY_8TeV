#include <TStyle.h>
#include <TChain.h>
#include <TFile.h>
#include <TH1D.h>
#include <TGraphAsymmErrors.h>
#include <TMultiGraph.h>
#include <TLegend.h>
#include <TCanvas.h>
#include <TROOT.h>
#include <THStack.h>
#include <TMath.h>
#include <TText.h>
#include <TPad.h>
#include <TPaveText.h>
#include <iostream>
#include <string>
#include <fstream>
#include <sstream>
#include <iomanip>
#include <vector>

using namespace std;

int Find_IndexRECOID( double muon_input, bool isPt )
{
 const int nptbins = 8;
 const int netabins = 20;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.5, -1.1, -0.9, -0.7, -0.5, -0.3, -0.1, 0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.5, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 30, 40, 50, 70, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}


double efficiency_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.984394, 1, 0.903949, 0.845892, 0.9766, 0.9236, 0.967137, 0.829695, 0.793146, 0.907939, 0.949845, 0.933692, 0.939298, 0.913491, 0.919888, 0.883972, 0.921924, 0.999999, 0.945651}, {
0.935987, 0.960078, 0.903473, 0.959336, 0.949957, 0.935302, 0.958577, 0.950613, 0.903048, 0.942381, 0.904447, 0.950544, 0.957989, 0.933253, 0.944317, 0.95386, 0.926008, 0.965718, 0.939262}, {
0.928324, 0.95549, 0.902042, 0.960295, 0.952409, 0.948215, 0.966448, 0.967024, 0.906426, 0.949096, 0.901506, 0.963158, 0.966053, 0.942041, 0.954587, 0.954336, 0.917696, 0.959712, 0.936138}, {
0.930978, 0.955584, 0.904331, 0.960982, 0.953083, 0.947645, 0.96838, 0.96837, 0.903164, 0.953109, 0.899887, 0.96222, 0.966555, 0.943107, 0.953764, 0.955684, 0.919076, 0.961456, 0.939417}, {
0.941675, 0.950349, 0.918436, 0.96889, 0.959312, 0.952309, 0.977374, 0.971363, 0.916435, 0.964299, 0.912996, 0.968671, 0.971243, 0.950998, 0.961617, 0.965749, 0.92607, 0.964097, 0.953103}, {
0.94402, 0.953456, 0.935152, 0.981399, 0.976916, 0.961843, 0.964596, 0.96775, 0.932032, 0.976324, 0.916022, 0.972295, 0.975595, 0.947628, 0.962355, 0.972279, 0.931617, 0.959326, 0.974527}, {
0.107278, 1, 1, 0.572794, 1, 0.670625, 1, 1, 0.791637, 1, 1, 1, 0.999999, 1, 1, 0.854291, 0.58987, 2.31063e-09, 4.28732e-10}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.942944, 0.975882, 0.9286, 0.95835, 0.95856, 0.957799, 0.964431, 0.963033, 0.938109, 0.96515, 0.935064, 0.977754, 0.978719, 0.92424, 0.957178, 0.961884, 0.938467, 0.974138, 0.949028}, {
0.945639, 0.970029, 0.920518, 0.964771, 0.960154, 0.95673, 0.977703, 0.978071, 0.925853, 0.966907, 0.923028, 0.975988, 0.975762, 0.956188, 0.960025, 0.960029, 0.935295, 0.970899, 0.948987}, {
0.947149, 0.966647, 0.918187, 0.966074, 0.96274, 0.958862, 0.979507, 0.977883, 0.926044, 0.969288, 0.920559, 0.976976, 0.976638, 0.957589, 0.962383, 0.959788, 0.934195, 0.968818, 0.948883}, {
0.948487, 0.965931, 0.919981, 0.96737, 0.964396, 0.957932, 0.978876, 0.977734, 0.925292, 0.969803, 0.91987, 0.977016, 0.977668, 0.957515, 0.962664, 0.960881, 0.933781, 0.967829, 0.951613}, {
0.951997, 0.966758, 0.923146, 0.973455, 0.965005, 0.959369, 0.983084, 0.981244, 0.926277, 0.973501, 0.923557, 0.97876, 0.980127, 0.958611, 0.966597, 0.96519, 0.934767, 0.966831, 0.955564}, {
0.955541, 0.962785, 0.923725, 0.980248, 0.970107, 0.96081, 0.983632, 0.982307, 0.929727, 0.978036, 0.921564, 0.982064, 0.978855, 0.959267, 0.96693, 0.97127, 0.92637, 0.967037, 0.95198}, {
1.99008e-07, 4.86178e-06, 0.717831, 0.96084, 0.979007, 1, 1, 1, 0.873783, 0.999999, 0.793452, 1, 0.9251, 1, 0.934285, 0.833715, 0.487467, 1.39908e-10, 0.999989}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0239871, 0.0145159, 0.0193886, 0.016459, 0.029623, 0.0553175, 0.0396999, 0.0357326, 0.0349457, 0.0480538, 0.0503994, 0.0465007, 0.0482604, 0.0350431, 0.0314591, 0.0188014, 0.0200713, 0.0197121, 0.0502697}, {
0.00438781, 0.00285667, 0.00206071, 0.00215711, 0.00272179, 0.0028008, 0.00282121, 0.00275977, 0.00278007, 0.00276323, 0.00280261, 0.00275114, 0.0028, 0.00283247, 0.0028765, 0.00214519, 0.00202592, 0.00276994, 0.00307798}, {
0.00144135, 0.00126997, 0.00102326, 0.000820164, 0.00105128, 0.000997172, 0.000885252, 0.000863708, 0.00106935, 0.000955472, 0.00106823, 0.000872573, 0.000874442, 0.00101304, 0.001039, 0.000839695, 0.000978602, 0.0273537, 0.00141698}, {
0.00115852, 0.000972548, 0.000774437, 0.000561841, 0.000776965, 0.000772412, 0.00067579, 0.00067979, 0.000931113, 0.00079262, 0.00093485, 0.000709331, 0.000687066, 0.000795474, 0.000770453, 0.000579822, 0.00072893, 0.000915307, 0.0011222}, {
1.55653e-05, 0.000134738, 0.00213964, 0.00173062, 0.00219324, 3.04138e-05, 5.88312e-05, 0.00200053, 3.81115e-06, 0.000127909, 0.000134792, 0.00203428, 0.00196611, 0.00214792, 0.00215788, 0.0017888, 0.00201163, 0.00280657, 0.00396397}, {
0.0176688, 0.0102568, 0.00620109, 0.00560046, 0.0060984, 0.00569487, 0.00582009, 0.00565749, 0.00641274, 0.00621119, 0.0545742, 0.00546268, 0.00582445, 0.0056212, 0.000372672, 0.00558274, 0.0057971, 0.00988804, 0.0186415}, {
0.000391278, 0.360797, 0.306033, 0.0596565, 0.114996, 0.158682, 0.129045, 0.14147, 0.00173886, 0.0509564, 0.24896, 0.15037, 0.0812956, 0.124647, 0.192693, 0.17645, 0.000536742, 3.82206e-12, 3.42397e-12}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00347853, 0.00400481, 0.00291337, 0.00370008, 0.00664951, 0.00813665, 0.010317, 0.0130726, 0.0152865, 0.0176676, 0.0149555, 0.0134092, 0.0105374, 0.049818, 0.0064829, 0.00372424, 0.00296282, 0.00378334, 0.0342931}, {
0.00105728, 0.00101802, 0.000917005, 0.000764115, 0.00104442, 0.00109225, 2.85132e-05, 0.000959531, 3.44747e-06, 0.00104726, 1.03829e-05, 0.000969934, 0.000971902, 0.00109026, 0.0010829, 0.000780826, 0.000862295, 0.000982101, 0.00103053}, {
0.00078938, 0.000738452, 0.000689666, 0.000478698, 0.00062544, 0.000606619, 0.000455136, 0.000459706, 0.000698437, 0.000512194, 0.000710352, 0.00045685, 0.000474377, 0.000605593, 0.000626819, 0.000509168, 0.000635268, 0.000712231, 0.000776743}, {
0.000713004, 0.000624358, 0.000552518, 0.000365893, 0.000508376, 0.00121162, 0.000399529, 0.000409026, 0.000645529, 0.000465054, 0.000662342, 0.0158814, 0.000407713, 0.00052566, 0.000518557, 0.000393774, 0.000512238, 0.000608658, 0.000699825}, {
0.00755189, 0.00161266, 0.00131585, 0.000896209, 0.00123379, 0.00119572, 0.000919071, 0.000940511, 0.00144033, 0.00107933, 0.00146588, 0.000950411, 0.000948048, 1.58119e-05, 3.5942e-05, 0.000975052, 0.00122513, 0.00158235, 0.0300572}, {
0.00499108, 0.00520864, 0.00338234, 0.0023709, 0.00291794, 0.026701, 0.00233831, 0.00229989, 0.00327849, 0.00261945, 0.00333523, 0.0023981, 0.00238758, 0.00282582, 0.00290958, 0.00238413, 0.003115, 0.00493767, 0.000384794}, {
3.21428e-08, 1.31475e-06, 0.140548, 0.0910586, 0.108686, 0.0669069, 0.0201737, 0.000906876, 0.126459, 0.0690475, 0.0971189, 0.0673858, 0.0811154, 0.0413695, 0.0936633, 0.0925321, 0.0664068, 1.28087e-11, 0.620917}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
int Find_Index( double muon_input, bool isPt )
{
 const int nptbins = 9;
 const int netabins = 18;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.7, -1.5, -1.1, -0.9, -0.7, -0.5, 0.5, 0.7, 0.9, 1.1, 1.5, 1.7, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 22, 30, 40, 50, 65, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}

double efficiency_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.901377, 0.916034, 0.904858, 0.89531, 0.892704, 0.918347, 0.907651, 0.889406, 0.8711, 0.892956, 0.906803, 0.916607, 0.898634, 0.901492, 0.903238, 0.915801, 0.905815}, {
0.959215, 0.958101, 0.948394, 0.944556, 0.943681, 0.955927, 0.944517, 0.941859, 0.923679, 0.939555, 0.94541, 0.9435, 0.943264, 0.94786, 0.954359, 0.966233, 0.960398}, {
0.978096, 0.982098, 0.97939, 0.977129, 0.976863, 0.973577, 0.975481, 0.974405, 0.975337, 0.974482, 0.971584, 0.976163, 0.975643, 0.975618, 0.980433, 0.98091, 0.97976}, {
0.990983, 0.992434, 0.990942, 0.990883, 0.989601, 0.989684, 0.989502, 0.988954, 0.989142, 0.989747, 0.989361, 0.98951, 0.989549, 0.989743, 0.99018, 0.991494, 0.990882}, {
0.995234, 0.995938, 0.996311, 0.996598, 0.996457, 0.996354, 0.995911, 0.995286, 0.995255, 0.995861, 0.995291, 0.996287, 0.996044, 0.996352, 0.996429, 0.995757, 0.995982}, {
0.995897, 0.996242, 0.997606, 0.997109, 0.997455, 0.997356, 0.996798, 0.997136, 0.996953, 0.997231, 0.996505, 0.996524, 0.997205, 0.997412, 0.997712, 0.996422, 0.995239}, {
0.995915, 0.996922, 0.996703, 0.998387, 0.997424, 0.998818, 0.997853, 0.998479, 0.997026, 0.998263, 0.996481, 0.998286, 0.997897, 0.99812, 0.997872, 0.997828, 0.996068}, {
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.92605, 0.931812, 0.925406, 0.927039, 0.931543, 0.929617, 0.929129, 0.924431, 0.903358, 0.918551, 0.924672, 0.92813, 0.927919, 0.926916, 0.931634, 0.941097, 0.931912}, {
0.967487, 0.96798, 0.962345, 0.96418, 0.963936, 0.959803, 0.961133, 0.957942, 0.947975, 0.960568, 0.962915, 0.960071, 0.962208, 0.960628, 0.968396, 0.967213, 0.967775}, {
0.981695, 0.982189, 0.980191, 0.977271, 0.976248, 0.974877, 0.974897, 0.976413, 0.977208, 0.976585, 0.975553, 0.973951, 0.976862, 0.97805, 0.981787, 0.982854, 0.983319}, {
0.99079, 0.991864, 0.99093, 0.990326, 0.989659, 0.989554, 0.990409, 0.990044, 0.990779, 0.990567, 0.990267, 0.989702, 0.989807, 0.989614, 0.990956, 0.992058, 0.991357}, {
0.995572, 0.997296, 0.99701, 0.99747, 0.997174, 0.996974, 0.996865, 0.996989, 0.997092, 0.996969, 0.996896, 0.996681, 0.997089, 0.997249, 0.997181, 0.997628, 0.995836}, {
0.996706, 0.99821, 0.998392, 0.998497, 0.998525, 0.997839, 0.998738, 0.998393, 0.998329, 0.99824, 0.998224, 0.998415, 0.998753, 0.99893, 0.998217, 0.998271, 0.997206}, {
0.997995, 0.997642, 0.998837, 0.9993, 0.998865, 0.999223, 0.998967, 0.998619, 0.998674, 0.999343, 0.998645, 0.999003, 0.998656, 0.999628, 0.998567, 0.998665, 0.996357}, {
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.00416691, 0.00473629, 0.00507952, 0.00545931, 0.00270777, 0.00571405, 0.00652508, 0.00749749, 0.00399197, 0.00781855, 0.00670992, 0.00581948, 0.00383227, 0.00531232, 0.00511776, 0.00486278, 0.00402596}, {
0.0024564, 0.00297519, 0.00319939, 0.00339262, 0.00238537, 0.00319792, 0.00349502, 0.00349134, 0.00206564, 0.00351712, 0.00352301, 0.0033239, 0.00238984, 0.00341826, 0.00312087, 0.0027362, 0.00242587}, {
0.000996144, 0.000965179, 0.00104842, 0.0010686, 0.00073838, 0.00107127, 0.00103044, 0.00098649, 0.000418003, 0.000978552, 0.000983654, 0.001023, 0.000745323, 0.00110176, 0.000996618, 0.000977113, 0.000983214}, {
0.000423453, 0.000430046, 0.000464228, 0.000449791, 0.00030229, 0.000400529, 0.000382448, 0.000373622, 0.00016068, 0.000357135, 0.000377684, 0.000397607, 0.000305494, 0.00047431, 0.000460996, 0.000434968, 0.000429311}, {
0.000328035, 0.00287068, 0.000281013, 0.000248307, 0.000167191, 0.000232583, 0.000238861, 0.000248679, 0.000110996, 0.000235506, 0.000255514, 0.000230276, 0.000122088, 0.000258866, 0.000274182, 7.34289e-05, 2.95371e-05}, {
0.00292109, 1.74461e-05, 0.000498848, 0.00207061, 0.000318293, 0.000418468, 0.000447177, 0.000426604, 0.000196688, 0.000410921, 0.000463187, 0.000481649, 0.000306497, 0.000512467, 0.000436104, 0.000587781, 8.61587e-06}, {
0.000105796, 7.02792e-05, 0.000781159, 0.000502012, 0.000530669, 0.000541866, 0.000655523, 0.000677089, 0.000310471, 0.000641126, 0.000606048, 0.00128852, 0.000351807, 0.000807958, 0.000788646, 0.00088178, 0.00160057}, {
0.639902, 0.109439, 0.224839, 0.0624608, 0.0198235, 0.0422789, 0.0335742, 0.0341617, 0.00607511, 0.0354122, 0.0311904, 0.0344644, 0.0240963, 0.0836182, 0.0934155, 0.707107, 0.376899}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00172552, 0.00204409, 0.00207168, 0.00230309, 0.00170802, 0.00290861, 0.00332692, 0.00394054, 0.00238587, 0.00342713, 0.00348185, 0.00286958, 0.00181107, 0.00229226, 0.00210792, 0.00196947, 0.00168822}, {
0.00121982, 0.00142423, 0.00155948, 0.00155012, 0.00107305, 0.00159422, 0.00175939, 0.0018986, 0.00108376, 0.00178099, 0.00166494, 0.0015915, 0.00110399, 0.00158836, 0.00145759, 0.00142613, 0.00122667}, {
0.000633888, 0.000734028, 0.000789093, 0.000816653, 0.00056012, 0.000764487, 0.000785082, 0.00072352, 0.000311362, 0.000733322, 0.000772861, 0.000809311, 0.000555546, 0.000816287, 0.000745707, 0.000721698, 0.000611924}, {
0.000323162, 0.00035442, 0.000380882, 0.000376314, 0.000242328, 0.000317023, 0.000296657, 0.000284159, 0.000120895, 0.000278152, 0.000301687, 0.000321441, 0.000244332, 0.000385917, 0.000371282, 0.000357301, 0.000314774}, {
0.000152062, 0.000202504, 0.00013932, 0.000182474, 0.000773587, 0.000170145, 0.000168683, 0.000161847, 7.12934e-05, 0.000171197, 0.00016507, 0.000174371, 0.000122993, 0.00042939, 0.00199327, 0.000192162, 0.000241653}, {
9.53682e-07, 0.000370563, 0.000300443, 0.000323953, 0.000178421, 2.67757e-05, 0.000240126, 0.000246641, 0.000113109, 0.000255436, 0.00026717, 0.000254607, 0.000320553, 0.000286664, 0.000336849, 0.00124979, 0.000415894}, {
0.000806703, 0.00066586, 0.000510666, 0.000435752, 0.000273622, 0.000601651, 0.000341644, 0.000310029, 0.00010921, 0.000291815, 0.000339668, 0.000275132, 0.000260401, 0.000357712, 0.000267476, 0.0005361, 0.00261643}, {
0.465797, 0.290834, 0.0791033, 0.070792, 0.0211983, 0.0391113, 0.0332353, 0.0215364, 0.00621946, 0.0249117, 0.0350299, 0.0498599, 0.0178477, 0.0677456, 0.144902, 0.542269, 0.353704}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0362552, 0.0403185, 0.040571, 0.0303527, 0.0245452, 0.0244423, 0.0110229, 0.0104526, 0.0105497, 0.0116656, 0.0129508, 0.0193141, 0.0252673, 0.0393178, 0.0390425, 0.0384872, 0.039324}, {
0.807056, 0.889949, 0.894975, 0.924087, 0.891666, 0.913678, 0.958699, 0.982415, 0.968393, 0.981627, 0.95469, 0.919361, 0.88599, 0.92408, 0.922884, 0.904303, 0.806192}, {
0.869782, 0.922623, 0.923778, 0.936697, 0.923273, 0.943807, 0.96384, 0.983136, 0.972799, 0.982955, 0.967545, 0.940429, 0.911611, 0.944185, 0.946487, 0.935043, 0.875819}, {
0.874547, 0.924449, 0.927746, 0.924598, 0.909632, 0.936576, 0.961011, 0.979693, 0.969688, 0.980763, 0.964411, 0.936182, 0.897722, 0.928286, 0.947191, 0.935294, 0.883058}, {
0.891374, 0.92731, 0.930351, 0.925724, 0.910298, 0.936339, 0.959124, 0.979623, 0.969524, 0.979739, 0.963285, 0.935543, 0.89936, 0.927685, 0.947801, 0.939955, 0.893319}, {
0.893813, 0.934215, 0.934045, 0.932609, 0.916352, 0.942215, 0.961759, 0.98264, 0.971804, 0.98348, 0.964696, 0.940671, 0.900308, 0.933263, 0.952495, 0.942645, 0.907488}, {
0.914893, 0.946946, 0.947494, 0.938779, 0.929559, 0.959089, 0.968588, 0.984325, 0.976236, 0.987106, 0.970571, 0.948918, 0.914532, 0.944437, 0.963917, 0.959651, 0.92893}, {
1, 1, 1, 1, 0.892401, 0.88619, 0.9708, 1, 0.951906, 1, 0.972964, 0.932779, 0.947685, 1, 0.923081, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.0309008, 0.0306183, 0.0351872, 0.0329851, 0.0259252, 0.0297483, 0.0106486, 0.00908909, 0.0098601, 0.00624535, 0.0131924, 0.0267205, 0.0263026, 0.0329684, 0.0345903, 0.0300586, 0.0304591}, {
0.746098, 0.864134, 0.896798, 0.915206, 0.892908, 0.925542, 0.965535, 0.976817, 0.969621, 0.97947, 0.96053, 0.932026, 0.890304, 0.920358, 0.914331, 0.870453, 0.72379}, {
0.822019, 0.899872, 0.921555, 0.924149, 0.912558, 0.941316, 0.968864, 0.980897, 0.974751, 0.98205, 0.962961, 0.944326, 0.909539, 0.928872, 0.930499, 0.908397, 0.813926}, {
0.856485, 0.913669, 0.931294, 0.907726, 0.906485, 0.941792, 0.967712, 0.981397, 0.973845, 0.981301, 0.966708, 0.940502, 0.906667, 0.919455, 0.93831, 0.916848, 0.850154}, {
0.875239, 0.921039, 0.934574, 0.90753, 0.907931, 0.945337, 0.967368, 0.982558, 0.975641, 0.984347, 0.966008, 0.942053, 0.908449, 0.916216, 0.941678, 0.922614, 0.876428}, {
0.880127, 0.923893, 0.936408, 0.907229, 0.909954, 0.945526, 0.968553, 0.983551, 0.976461, 0.982765, 0.964381, 0.941373, 0.906338, 0.912369, 0.942583, 0.923028, 0.882534}, {
0.877576, 0.907883, 0.930454, 0.911715, 0.908074, 0.941773, 0.962457, 0.976348, 0.970981, 0.979376, 0.962818, 0.942426, 0.901337, 0.911817, 0.94469, 0.919188, 0.890979}, {
1.32627e-08, 1, 0.730778, 0.867473, 0.836652, 0.96416, 0.866008, 0.962264, 0.940671, 0.945241, 0.935868, 0.959226, 0.884371, 0.904762, 1, 1.86163e-10, 0.862535}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
9.88449e-05, 0.000125771, 0.000147449, 9.53593e-05, 4.15451e-05, 5.93654e-05, 2.09162e-05, 2.44637e-05, 7.90918e-05, 2.9417e-05, 3.03355e-05, 5.36725e-05, 5.07374e-05, 0.000138104, 0.000119807, 0.000134173, 0.00011184}, {
0.00396245, 0.00398879, 0.00284192, 0.00356684, 0.0028743, 0.00382063, 0.00271396, 0.00195236, 0.00104267, 0.00197624, 0.00286287, 0.0025653, 0.00294852, 0.00375456, 0.00355821, 0.00386169, 0.00411398}, {
0.00182082, 0.00173047, 0.00173979, 0.00157457, 0.00117669, 0.00145478, 0.00116547, 0.000793886, 0.000417726, 0.000788278, 0.00107615, 0.00148223, 0.00124566, 0.00148995, 0.00143952, 0.00160921, 0.00179545}, {
0.00119785, 0.00114283, 0.00103042, 0.00113536, 0.000749528, 0.0008781, 0.000609098, 1.9802e-05, 0.000244811, 0.000446312, 0.000632232, 0.000841878, 0.000788315, 0.000787142, 0.000963477, 0.000746862, 0.00118538}, {
0.000898968, 0.00112217, 0.00102968, 0.000689454, 0.000685887, 0.000820909, 0.000668238, 0.000477278, 0.000259358, 0.000325857, 0.025012, 0.0426439, 0.000707187, 0.000981202, 0.000871687, 3.46495e-05, 0.00123655}, {
0.00178878, 0.00228547, 0.00141265, 0.0444649, 0.00164498, 0.00163902, 0.00136857, 0.000927193, 0.000513, 0.000909016, 0.00129198, 0.0394808, 0.00148729, 0.0020051, 0.0017651, 0.00201917, 0.0593886}, {
0.00501237, 0.000272514, 0.00355283, 0.0407032, 0.00214209, 0.00238885, 0.00201746, 0.010952, 0.0164135, 0.00128231, 0.00197424, 0.00249398, 0.00230285, 0.00314924, 0.00276552, 0.0033833, 0.00468185}, {
0.617998, 0.131359, 0.698238, 0.0768336, 0.0380315, 0.06272, 0.0303115, 0.0364624, 0.0143315, 0.0397122, 0.027652, 0.0440482, 0.0328968, 0.0217554, 0.0710163, 0.413264, 0.706229}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
1.74149e-05, 2.17188e-05, 2.51827e-05, 2.34961e-05, 1.38394e-05, 2.75228e-05, 7.7178e-06, 5.49206e-06, 4.17205e-06, 3.29029e-06, 9.821e-06, 1.75535e-06, 9.3535e-06, 2.4667e-05, 2.42658e-05, 1.87942e-05, 1.75479e-05}, {
0.00107231, 0.00116479, 0.00109491, 2.14519e-05, 0.000788353, 0.00100205, 4.24256e-05, 0.000592061, 0.000298626, 0.000652701, 0.000747979, 0.000920976, 0.000795418, 0.00100104, 0.00101241, 0.00116813, 0.00106419}, {
0.000704188, 0.000709567, 0.000666094, 0.000645035, 0.000467279, 0.000536219, 0.000426494, 0.000292328, 4.63534e-05, 0.000315665, 0.000414486, 0.000554431, 0.000444725, 0.000625691, 0.000617543, 0.000686649, 0.000704848}, {
0.000490164, 0.000482592, 0.000445254, 0.000472739, 0.000311068, 0.000339402, 0.00025128, 0.000183738, 9.37458e-05, 0.000174076, 0.000257949, 0.0003438, 0.000303789, 0.000453393, 0.000400597, 0.00048074, 0.000491769}, {
1.71619e-05, 0.000474292, 0.000417981, 0.0593408, 0.00028835, 0.000321103, 0.000250091, 0.00018537, 9.43368e-05, 0.000108832, 0.000194268, 0.000327906, 0.000288814, 0.000396082, 0.000386029, 0.0504864, 0.0765821}, {
0.0011183, 0.000961035, 0.00087809, 0.00091395, 0.000597483, 0.000662088, 0.000514773, 0.000377012, 0.000195174, 0.00037736, 0.000533813, 0.000673864, 0.0600273, 0.000887301, 0.000809924, 0.000968637, 0.00109041}, {
0.0759832, 0.00179196, 0.00154013, 0.00154535, 0.0010085, 0.00113588, 0.000923305, 0.000713147, 0.000346061, 0.000644666, 0.000866768, 0.00110047, 0.00101808, 0.00150883, 0.00139999, 0.00174305, 0.00215134}, {
9.24838e-10, 0.0672417, 0.0408289, 0.0353007, 0.0200707, 0.018204, 0.0251002, 0.0113364, 0.00709442, 0.0176109, 0.022997, 0.0204588, 0.0152421, 0.026013, 0.0141846, 2.55248e-12, 0.0515316}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 //FIXME temporary protection
 if (index_pt == 0) index_pt = 1;

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.931473, 0.964988, 0.961026, 0.976551, 0.982818, 0.984502, 0.977504, 0.994073, 0.982976, 0.993896, 0.982092, 0.983407, 0.978925, 0.984489, 0.981202, 0.971029, 0.933461}, {
0.940066, 0.970222, 0.9668, 0.981433, 0.984594, 0.982952, 0.982001, 0.99582, 0.983882, 0.993446, 0.979007, 0.985264, 0.981821, 0.982455, 0.982694, 0.978178, 0.942181}, {
0.949997, 0.976191, 0.972337, 0.98237, 0.987047, 0.989087, 0.983476, 0.995404, 0.985518, 0.99507, 0.984716, 0.987383, 0.983654, 0.987625, 0.98348, 0.983041, 0.948788}, {
0.945679, 0.975108, 0.971687, 0.979477, 0.984606, 0.986925, 0.980589, 0.994105, 0.985302, 0.99428, 0.982471, 0.987048, 0.980514, 0.982898, 0.982961, 0.982366, 0.949981}, {
0.95266, 0.975208, 0.973705, 0.980528, 0.98497, 0.986491, 0.978825, 0.994099, 0.984523, 0.994358, 0.98172, 0.986693, 0.981307, 0.983227, 0.984255, 0.983275, 0.953864}, {
0.951293, 0.978407, 0.975767, 0.984921, 0.98602, 0.987556, 0.980735, 0.995382, 0.985675, 0.995216, 0.98223, 0.988792, 0.9825, 0.983827, 0.985551, 0.981214, 0.956842}, {
0.969414, 0.983012, 0.975138, 0.984399, 0.988599, 0.989892, 0.984951, 0.995857, 0.988315, 0.99741, 0.986646, 0.988797, 0.985172, 0.985815, 0.987496, 0.989216, 0.975526}, {
1, 1, 1, 1, 0.982473, 1, 0.9708, 1, 0.99037, 1, 1, 0.966464, 1, 1, 0.923081, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.558419, 0.589792, 0.630292, 0.685812, 0.789191, 0.892765, 0.925279, 0.943273, 0.957379, 0.947371, 0.917714, 0.899592, 0.786922, 0.688974, 0.646828, 0.594218, 0.546803}, {
0.89231, 0.935429, 0.950448, 0.963229, 0.971446, 0.982005, 0.985517, 0.994281, 0.989635, 0.994887, 0.982549, 0.982666, 0.968016, 0.965857, 0.958651, 0.94025, 0.882169}, {
0.927996, 0.960108, 0.967127, 0.970375, 0.979858, 0.987904, 0.986751, 0.994713, 0.990135, 0.995063, 0.9817, 0.987878, 0.97727, 0.972341, 0.970564, 0.963867, 0.925775}, {
0.939933, 0.967078, 0.97256, 0.971611, 0.981052, 0.988368, 0.98626, 0.995453, 0.990294, 0.995143, 0.983551, 0.98759, 0.978957, 0.974033, 0.975448, 0.970038, 0.936692}, {
0.9461, 0.969735, 0.973197, 0.973494, 0.982039, 0.989559, 0.986355, 0.995805, 0.990531, 0.996174, 0.983687, 0.987484, 0.979932, 0.974523, 0.97681, 0.971593, 0.945459}, {
0.943452, 0.969329, 0.974301, 0.971506, 0.981817, 0.988047, 0.98562, 0.995958, 0.990866, 0.994323, 0.983982, 0.986235, 0.978815, 0.972845, 0.974663, 0.968931, 0.943675}, {
0.932981, 0.954895, 0.964125, 0.969168, 0.975499, 0.980577, 0.981323, 0.990563, 0.98616, 0.990371, 0.978971, 0.980929, 0.971866, 0.966763, 0.970966, 0.957691, 0.934231}, {
1, 1, 0.933666, 0.935184, 0.933863, 1, 0.895755, 0.981131, 0.960686, 0.974955, 0.935868, 0.959226, 0.942018, 0.95238, 1, 9.50651e-07, 1}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.00389096, 0.0029579, 0.00329332, 0.00274283, 4.33799e-05, 0.00213073, 0.00300005, 0.00176085, 0.0015128, 0.00177104, 0.00250557, 0.00205653, 0.00154671, 0.00231391, 0.00247941, 0.00286184, 0.00341859}, {
0.00280011, 0.00213695, 0.00230554, 0.00168499, 0.0007705, 0.00189688, 0.00186577, 0.0009759, 0.000752665, 0.0011957, 0.00181063, 0.00153752, 0.00135018, 0.00182138, 0.00191872, 0.00210088, 0.00279855}, {
0.00130175, 0.00103063, 0.00113322, 0.000895217, 0.000372848, 0.000594044, 0.000810081, 0.000429694, 0.000281943, 0.000439301, 0.00076509, 0.000698233, 0.000579088, 0.000755845, 0.000764257, 0.00089889, 0.00130408}, {
0.00081721, 0.000717463, 0.000671875, 0.000573731, 0.000351058, 0.000302714, 0.000452674, 0.000234406, 0.000175332, 0.000255728, 0.000430171, 0.000424118, 0.000394115, 0.000562639, 0.000583162, 0.000415189, 0.000871741}, {
0.000653626, 0.000534347, 0.000692783, 5.87841e-05, 0.000317741, 0.000417187, 0.000331507, 0.000257358, 0.000128639, 1.81598e-05, 0.000466001, 0.000383284, 0.000346984, 0.000526201, 0.000351516, 0.000100127, 0.0311244}, {
0.00213616, 0.00143066, 0.00139072, 0.000778533, 0.000644446, 0.000488835, 0.00098323, 0.000502044, 0.000369266, 0.000493913, 0.000941212, 0.000811322, 0.000718007, 0.0112736, 0.00120358, 0.000788862, 0.029229}, {
0.00367177, 0.00159193, 0.0172103, 0.0109386, 0.000954535, 0.000869449, 0.000986775, 0.00073865, 0.000544829, 0.000619381, 0.00138735, 0.00788452, 0.001146, 0.00172307, 0.00170223, 0.00201056, 0.00368043}, {
0.617998, 0.131359, 0.698238, 0.072896, 0.018273, 0.0491728, 0.0303115, 0.0364624, 0.00371186, 0.0397122, 0.0344789, 0.0339666, 0.00662438, 0.0785726, 0.0710163, 0.413264, 0.204049}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.000922478, 0.00116881, 0.00130613, 0.00140783, 0.00110038, 0.00169105, 0.00181416, 0.00167915, 0.0008909, 0.00168812, 0.00175913, 0.00163889, 0.0011418, 0.0014405, 0.00129854, 0.0011743, 0.000898096}, {
0.000915606, 0.000884467, 0.000610052, 0.00073386, 0.000465222, 0.000552907, 0.000524969, 0.000360922, 0.000196918, 0.000363597, 0.000507108, 0.000470901, 0.000497487, 0.000718079, 0.000758731, 0.0397286, 0.000644551}, {
0.000535603, 0.000490099, 0.000463874, 0.000413635, 0.000251209, 0.00845142, 0.000287619, 0.000165013, 9.08545e-05, 0.000152432, 0.000299742, 0.000279115, 0.015708, 0.000421267, 0.000429284, 0.000478311, 0.000543056}, {
0.000366682, 0.000318612, 0.000300771, 0.000294925, 0.000158126, 0.000160161, 0.000107249, 9.47123e-05, 5.68498e-05, 9.18372e-05, 0.000130332, 0.000169575, 0.000170174, 0.000283179, 0.000261863, 0.000316804, 0.000371032}, {
0.000468593, 0.020754, 0.000270759, 0.000262408, 0.000142534, 0.000152795, 0.000163156, 0.000319661, 3.73753e-05, 0.00269697, 0.0113476, 0.000154952, 0.013906, 0.000259185, 0.000255696, 0.0195174, 0.0364639}, {
0.00080213, 0.000650431, 0.000601595, 0.000560279, 0.000304477, 0.00032917, 0.000356843, 0.000193808, 0.000125014, 0.000223051, 0.000371874, 0.00960246, 0.000327553, 0.000538052, 0.00056507, 0.000663952, 0.000856324}, {
0.0017378, 0.00138966, 0.00114927, 0.00099713, 0.0169054, 0.000710223, 0.00067307, 0.000472646, 0.000244113, 0.00675059, 0.000481823, 0.000662792, 0.000608101, 0.000714376, 0.00103504, 0.00134803, 0.0018315}, {
0.0504025, 0.0672417, 0.0275342, 0.027055, 0.0137521, 0.00665117, 0.0238751, 0.00832017, 0.00591744, 0.0311398, 0.022997, 0.0204588, 0.0118952, 0.0200263, 0.0141846, 1.92371e-07, 0.0334038}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
