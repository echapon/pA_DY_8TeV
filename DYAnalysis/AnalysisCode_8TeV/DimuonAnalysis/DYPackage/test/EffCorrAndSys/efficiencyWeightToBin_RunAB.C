#include <TStyle.h>
#include <TChain.h>
#include <TFile.h>
#include <TH1D.h>
#include <TGraphAsymmErrors.h>
#include <TMultiGraph.h>
#include <TLegend.h>
#include <TCanvas.h>
#include <TROOT.h>
#include <THStack.h>
#include <TMath.h>
#include <TText.h>
#include <TPad.h>
#include <TPaveText.h>
#include <iostream>
#include <string>
#include <fstream>
#include <sstream>
#include <iomanip>
#include <vector>

using namespace std;

int Find_IndexRECOID( double muon_input, bool isPt )
{
 const int nptbins = 8;
 const int netabins = 20;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.5, -1.1, -0.9, -0.7, -0.5, -0.3, -0.1, 0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.5, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 30, 40, 50, 70, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}


double efficiency_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.986769, 1, 0.892535, 0.85972, 0.900122, 0.847468, 0.950127, 0.997801, 0.90569, 0.924659, 0.935996, 0.895923, 0.999996, 0.903253, 0.97892, 0.863093, 0.93873, 1, 0.987221}, {
0.932831, 0.96384, 0.907767, 0.960119, 0.952314, 0.941596, 0.96181, 0.962028, 0.919714, 0.955434, 0.907798, 0.958875, 0.963461, 0.940013, 0.960954, 0.957239, 0.929571, 0.966972, 0.941}, {
0.928461, 0.958131, 0.904857, 0.963471, 0.955207, 0.950347, 0.971589, 0.970667, 0.908992, 0.955329, 0.904827, 0.967324, 0.969801, 0.948406, 0.959035, 0.959159, 0.927406, 0.962761, 0.943529}, {
0.934131, 0.958345, 0.908453, 0.963174, 0.95434, 0.948178, 0.971211, 0.969301, 0.907518, 0.954804, 0.899729, 0.96799, 0.968974, 0.948307, 0.957244, 0.957321, 0.928821, 0.964715, 0.942642}, {
0.944634, 0.960421, 0.921777, 0.969626, 0.967087, 0.95648, 0.974703, 0.976297, 0.916254, 0.965367, 0.914166, 0.979206, 0.977444, 0.952728, 0.96334, 0.968353, 0.943417, 0.9636, 0.948215}, {
0.98696, 0.963498, 0.930396, 0.971318, 0.972982, 0.964183, 0.974783, 0.987354, 0.92925, 0.972447, 0.918075, 0.967497, 0.98048, 0.95592, 0.964002, 0.975211, 0.939154, 0.966421, 0.922429}, {
0.0694756, 0.39025, 1, 0.816437, 0.886997, 0.934904, 1, 0.714985, 0.961338, 0.896134, 0.718702, 0.77382, 0.999939, 0.919373, 0.789049, 0.999998, 0.999994, 0.654928, 2.02101e-09}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.942944, 0.975882, 0.9286, 0.95835, 0.95856, 0.957799, 0.964431, 0.963033, 0.938109, 0.96515, 0.935064, 0.977754, 0.978719, 0.92424, 0.957178, 0.961884, 0.938467, 0.974138, 0.949028}, {
0.945639, 0.970029, 0.920518, 0.964771, 0.960154, 0.95673, 0.977703, 0.978071, 0.925853, 0.966907, 0.923028, 0.975988, 0.975762, 0.956188, 0.960025, 0.960029, 0.935295, 0.970899, 0.948987}, {
0.947149, 0.966647, 0.918187, 0.966074, 0.96274, 0.958862, 0.979507, 0.977883, 0.926044, 0.969288, 0.920559, 0.976976, 0.976638, 0.957589, 0.962383, 0.959788, 0.934195, 0.968818, 0.948883}, {
0.948487, 0.965931, 0.919981, 0.96737, 0.964396, 0.957932, 0.978876, 0.977734, 0.925292, 0.969803, 0.91987, 0.977016, 0.977668, 0.957515, 0.962664, 0.960881, 0.933781, 0.967829, 0.951613}, {
0.951997, 0.966758, 0.923146, 0.973455, 0.965005, 0.959369, 0.983084, 0.981244, 0.926277, 0.973501, 0.923557, 0.97876, 0.980127, 0.958611, 0.966597, 0.96519, 0.934767, 0.966831, 0.955564}, {
0.955541, 0.962785, 0.923725, 0.980248, 0.970107, 0.96081, 0.983632, 0.982307, 0.929727, 0.978036, 0.921564, 0.982064, 0.978855, 0.959267, 0.96693, 0.97127, 0.92637, 0.967037, 0.95198}, {
1.99008e-07, 4.86178e-06, 0.717831, 0.96084, 0.979007, 1, 1, 1, 0.873783, 0.999999, 0.793452, 1, 0.9251, 1, 0.934285, 0.833715, 0.487467, 1.39908e-10, 0.999989}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0253565, 0.10041, 0.0203552, 0.0198912, 0.0319053, 0.031654, 0.0494059, 0.0913319, 0.060347, 0.0590863, 0.0604885, 0.0483728, 0.0395904, 0.0376286, 0.0317596, 0.0190393, 0.0232424, 0.0146722, 0.0227867}, {
0.00338912, 0.00316982, 0.00231657, 0.00243665, 0.00330871, 0.00317309, 0.00319607, 0.00313995, 0.00319286, 1.9276e-06, 0.00317078, 0.00313914, 0.00318785, 0.00321787, 0.00330227, 0.00241336, 0.00224445, 0.00305819, 0.00333029}, {
0.00162484, 0.00140789, 0.00117788, 0.000912305, 0.00118835, 0.00112717, 0.000974396, 0.000945928, 0.00122236, 0.00105248, 0.00121731, 0.000961187, 0.000967089, 0.00112012, 0.00115194, 0.000935517, 0.00108923, 0.00132675, 0.00156927}, {
0.00133596, 0.00108509, 0.00088432, 0.000631459, 0.000875597, 0.000883914, 0.000753583, 0.000766474, 0.00105234, 0.00088364, 0.001082, 0.000766901, 0.000765064, 0.000882606, 0.000862846, 0.00065253, 0.000806245, 0.00101326, 0.00127557}, {
1.0345e-05, 0.0031827, 0.00234094, 0.00190334, 0.00237643, 0.00229637, 0.0021237, 7.35462e-05, 0.00267228, 7.35121e-05, 0.00263719, 0.0021351, 0.00210751, 0.00231313, 0.00236991, 0.00193262, 0.00220201, 0.00217875, 0.004271}, {
0.000470134, 0.0107187, 0.00640264, 0.00593354, 0.00643142, 0.00612592, 0.00590357, 0.00561909, 0.00641574, 0.00646263, 0.00637795, 0.00559223, 0.00568662, 0.030088, 0.00648159, 0.00579079, 0.00637041, 0.0103715, 5.35508e-05}, {
0.035164, 0.152021, 0.085214, 0.165948, 0.188489, 0.151556, 0.0396379, 0.138599, 0.11901, 0.134389, 0.129451, 0.11332, 0.177703, 0.222161, 0.151873, 0.100778, 0.471522, 0.231577, 6.09878e-11}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00347853, 0.00400481, 0.00291337, 0.00370008, 0.00664951, 0.00813665, 0.010317, 0.0130726, 0.0152865, 0.0176676, 0.0149555, 0.0134092, 0.0105374, 0.049818, 0.0064829, 0.00372424, 0.00296282, 0.00378334, 0.0342931}, {
0.00105728, 0.00101802, 0.000917005, 0.000764115, 0.00104442, 0.00109225, 2.85132e-05, 0.000959531, 3.44747e-06, 0.00104726, 1.03829e-05, 0.000969934, 0.000971902, 0.00109026, 0.0010829, 0.000780826, 0.000862295, 0.000982101, 0.00103053}, {
0.00078938, 0.000738452, 0.000689666, 0.000478698, 0.00062544, 0.000606619, 0.000455136, 0.000459706, 0.000698437, 0.000512194, 0.000710352, 0.00045685, 0.000474377, 0.000605593, 0.000626819, 0.000509168, 0.000635268, 0.000712231, 0.000776743}, {
0.000713004, 0.000624358, 0.000552518, 0.000365893, 0.000508376, 0.00121162, 0.000399529, 0.000409026, 0.000645529, 0.000465054, 0.000662342, 0.0158814, 0.000407713, 0.00052566, 0.000518557, 0.000393774, 0.000512238, 0.000608658, 0.000699825}, {
0.00755189, 0.00161266, 0.00131585, 0.000896209, 0.00123379, 0.00119572, 0.000919071, 0.000940511, 0.00144033, 0.00107933, 0.00146588, 0.000950411, 0.000948048, 1.58119e-05, 3.5942e-05, 0.000975052, 0.00122513, 0.00158235, 0.0300572}, {
0.00499108, 0.00520864, 0.00338234, 0.0023709, 0.00291794, 0.026701, 0.00233831, 0.00229989, 0.00327849, 0.00261945, 0.00333523, 0.0023981, 0.00238758, 0.00282582, 0.00290958, 0.00238413, 0.003115, 0.00493767, 0.000384794}, {
3.21428e-08, 1.31475e-06, 0.140548, 0.0910586, 0.108686, 0.0669069, 0.0201737, 0.000906876, 0.126459, 0.0690475, 0.0971189, 0.0673858, 0.0811154, 0.0413695, 0.0936633, 0.0925321, 0.0664068, 1.28087e-11, 0.620917}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
int Find_Index( double muon_input, bool isPt )
{
 const int nptbins = 9;
 const int netabins = 18;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.7, -1.5, -1.1, -0.9, -0.7, -0.5, 0.5, 0.7, 0.9, 1.1, 1.5, 1.7, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 22, 30, 40, 50, 65, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}

double efficiency_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.90718, 0.916878, 0.916053, 0.912901, 0.911213, 0.921734, 0.9123, 0.909155, 0.871214, 0.889378, 0.897555, 0.915739, 0.906752, 0.906466, 0.898431, 0.920412, 0.919733}, {
0.962922, 0.962992, 0.963123, 0.948917, 0.949616, 0.948754, 0.951171, 0.940592, 0.929108, 0.934148, 0.950499, 0.953636, 0.947649, 0.950481, 0.961349, 0.960127, 0.960592}, {
0.980502, 0.984653, 0.98086, 0.978004, 0.977203, 0.976096, 0.975664, 0.976507, 0.977375, 0.976472, 0.976332, 0.976854, 0.9782, 0.980561, 0.981352, 0.982191, 0.982418}, {
0.990774, 0.992326, 0.993153, 0.990999, 0.990558, 0.990374, 0.989909, 0.990005, 0.990441, 0.990816, 0.990428, 0.990849, 0.990568, 0.990437, 0.990852, 0.99235, 0.990836}, {
0.996289, 0.996218, 0.996612, 0.997141, 0.996534, 0.996476, 0.996056, 0.995746, 0.995787, 0.99671, 0.995827, 0.996692, 0.99671, 0.99645, 0.996733, 0.99599, 0.995896}, {
0.996918, 0.997102, 0.997815, 0.998353, 0.997126, 0.997643, 0.9971, 0.997585, 0.996814, 0.997427, 0.996648, 0.997231, 0.997591, 0.99786, 0.997556, 0.997557, 0.995541}, {
0.99836, 0.99745, 0.997831, 0.996812, 0.998675, 0.997653, 0.997444, 0.996949, 0.997882, 0.99859, 0.99667, 0.998867, 0.996616, 0.998626, 0.998118, 0.995706, 0.999254}, {
1, 1, 1, 1, 1, 1, 0.965516, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.92605, 0.931812, 0.925406, 0.927039, 0.931543, 0.929617, 0.929129, 0.924431, 0.903358, 0.918551, 0.924672, 0.92813, 0.927919, 0.926916, 0.931634, 0.941097, 0.931912}, {
0.967487, 0.96798, 0.962345, 0.96418, 0.963936, 0.959803, 0.961133, 0.957942, 0.947975, 0.960568, 0.962915, 0.960071, 0.962208, 0.960628, 0.968396, 0.967213, 0.967775}, {
0.981695, 0.982189, 0.980191, 0.977271, 0.976248, 0.974877, 0.974897, 0.976413, 0.977208, 0.976585, 0.975553, 0.973951, 0.976862, 0.97805, 0.981787, 0.982854, 0.983319}, {
0.99079, 0.991864, 0.99093, 0.990326, 0.989659, 0.989554, 0.990409, 0.990044, 0.990779, 0.990567, 0.990267, 0.989702, 0.989807, 0.989614, 0.990956, 0.992058, 0.991357}, {
0.995572, 0.997296, 0.99701, 0.99747, 0.997174, 0.996974, 0.996865, 0.996989, 0.997092, 0.996969, 0.996896, 0.996681, 0.997089, 0.997249, 0.997181, 0.997628, 0.995836}, {
0.996706, 0.99821, 0.998392, 0.998497, 0.998525, 0.997839, 0.998738, 0.998393, 0.998329, 0.99824, 0.998224, 0.998415, 0.998753, 0.99893, 0.998217, 0.998271, 0.997206}, {
0.997995, 0.997642, 0.998837, 0.9993, 0.998865, 0.999223, 0.998967, 0.998619, 0.998674, 0.999343, 0.998645, 0.999003, 0.998656, 0.999628, 0.998567, 0.998665, 0.996357}, {
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

/*
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.},{
1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.}};
*/

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.00484716, 0.00551976, 0.00584979, 0.00583785, 0.00455264, 0.00653945, 0.00750574, 0.00881506, 0.0047363, 0.0088984, 0.00774504, 0.00692851, 0.00435081, 0.00600685, 0.00611791, 0.00546567, 0.0045417}, {
0.00282463, 0.00329985, 0.00335262, 0.0038648, 0.00272842, 0.00383469, 0.00384521, 0.00409832, 0.00233574, 0.00443112, 0.00385325, 0.00373295, 0.00270632, 0.00387232, 0.00355161, 0.00341787, 0.00281402}, {
0.00110825, 0.00106972, 0.00119231, 0.00122575, 0.000844496, 0.00117088, 0.00118269, 0.00111279, 0.000473103, 0.0010974, 0.00116812, 0.00119839, 0.000831058, 0.00117231, 0.00111529, 0.00111158, 0.00106808}, {
0.000501793, 0.000497858, 0.000472197, 0.000510714, 0.000341622, 0.00045384, 0.000432954, 0.000408304, 0.000177759, 0.000392633, 0.0004168, 0.0004344, 0.000341602, 0.000533315, 0.000522709, 0.000496748, 0.000493693}, {
1.12415e-05, 0.000317801, 0.000315864, 0.000277823, 0.000187008, 0.000259467, 0.000272105, 0.00027677, 0.000122707, 0.000251311, 0.000278744, 0.000255342, 0.000193913, 0.000301426, 0.000302719, 0.000257302, 0.00290142}, {
0.000560959, 0.000540929, 0.000566685, 0.000301859, 0.000368051, 0.000495947, 0.000534951, 0.000467593, 0.000231089, 0.000491709, 0.000351973, 0.000516948, 0.000363074, 0.000471452, 0.000584279, 0.000669396, 0.00062029}, {
1.04701e-05, 0.00136175, 0.000728548, 0.00106646, 0.000579199, 0.000726765, 0.000555396, 0.00079227, 0.000351448, 0.000541989, 8.48432e-06, 0.000675647, 0.00241803, 0.000938715, 0.000893388, 0.00132327, 0.000111576}, {
0.358825, 0.164192, 0.122685, 0.0771941, 0.0332832, 0.0624608, 0.0347589, 0.0363975, 0.00713659, 0.0438767, 0.0504327, 0.0374392, 0.0291082, 0.119446, 0.121331, 0.218645, 0.410871}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00172552, 0.00204409, 0.00207168, 0.00230309, 0.00170802, 0.00290861, 0.00332692, 0.00394054, 0.00238587, 0.00342713, 0.00348185, 0.00286958, 0.00181107, 0.00229226, 0.00210792, 0.00196947, 0.00168822}, {
0.00121982, 0.00142423, 0.00155948, 0.00155012, 0.00107305, 0.00159422, 0.00175939, 0.0018986, 0.00108376, 0.00178099, 0.00166494, 0.0015915, 0.00110399, 0.00158836, 0.00145759, 0.00142613, 0.00122667}, {
0.000633888, 0.000734028, 0.000789093, 0.000816653, 0.00056012, 0.000764487, 0.000785082, 0.00072352, 0.000311362, 0.000733322, 0.000772861, 0.000809311, 0.000555546, 0.000816287, 0.000745707, 0.000721698, 0.000611924}, {
0.000323162, 0.00035442, 0.000380882, 0.000376314, 0.000242328, 0.000317023, 0.000296657, 0.000284159, 0.000120895, 0.000278152, 0.000301687, 0.000321441, 0.000244332, 0.000385917, 0.000371282, 0.000357301, 0.000314774}, {
0.000152062, 0.000202504, 0.00013932, 0.000182474, 0.000773587, 0.000170145, 0.000168683, 0.000161847, 7.12934e-05, 0.000171197, 0.00016507, 0.000174371, 0.000122993, 0.00042939, 0.00199327, 0.000192162, 0.000241653}, {
9.53682e-07, 0.000370563, 0.000300443, 0.000323953, 0.000178421, 2.67757e-05, 0.000240126, 0.000246641, 0.000113109, 0.000255436, 0.00026717, 0.000254607, 0.000320553, 0.000286664, 0.000336849, 0.00124979, 0.000415894}, {
0.000806703, 0.00066586, 0.000510666, 0.000435752, 0.000273622, 0.000601651, 0.000341644, 0.000310029, 0.00010921, 0.000291815, 0.000339668, 0.000275132, 0.000260401, 0.000357712, 0.000267476, 0.0005361, 0.00261643}, {
0.465797, 0.290834, 0.0791033, 0.070792, 0.0211983, 0.0391113, 0.0332353, 0.0215364, 0.00621946, 0.0249117, 0.0350299, 0.0498599, 0.0178477, 0.0677456, 0.144902, 0.542269, 0.353704}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0463607, 0.0451858, 0.0450328, 0.0394024, 0.029621, 0.0210462, 0.0130863, 0.00583161, 0.010253, 0.0126884, 0.0189881, 0.0257029, 0.0271507, 0.0327571, 0.0386035, 0.0389724, 0.0420674}, {
0.788666, 0.883491, 0.877055, 0.909879, 0.889758, 0.927876, 0.954063, 0.978338, 0.96229, 0.983682, 0.953147, 0.922284, 0.884843, 0.921861, 0.918364, 0.901605, 0.813054}, {
0.855511, 0.922687, 0.923176, 0.930641, 0.923127, 0.946652, 0.962097, 0.98083, 0.970038, 0.983163, 0.965082, 0.947717, 0.909168, 0.936647, 0.949139, 0.943904, 0.870428}, {
0.874678, 0.920796, 0.925476, 0.916083, 0.907759, 0.942915, 0.961714, 0.979441, 0.966444, 0.980817, 0.965, 0.941483, 0.896467, 0.916553, 0.948763, 0.940708, 0.885475}, {
0.889837, 0.929274, 0.931652, 0.913605, 0.905996, 0.941651, 0.960114, 0.978648, 0.9665, 0.980162, 0.961199, 0.941707, 0.893155, 0.909904, 0.953208, 0.945888, 0.900647}, {
0.907092, 0.935107, 0.933277, 0.915811, 0.912096, 0.943969, 0.963379, 0.980332, 0.968575, 0.981754, 0.962756, 0.945644, 0.896477, 0.908154, 0.956319, 0.948729, 0.907634}, {
0.909446, 0.938286, 0.942368, 0.925865, 0.917253, 0.956618, 0.970957, 0.981043, 0.97197, 0.984855, 0.967396, 0.958311, 0.903673, 0.927398, 0.963845, 0.953258, 0.929655}, {
1, 0.632141, 1, 0.931873, 0.886553, 0.950029, 0.886122, 1, 0.978275, 1, 1, 0.914286, 0.975001, 1, 0.755968, 1, 2.86935e-09}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.0309008, 0.0306183, 0.0351872, 0.0329851, 0.0259252, 0.0297483, 0.0106486, 0.00908909, 0.0098601, 0.00624535, 0.0131924, 0.0267205, 0.0263026, 0.0329684, 0.0345903, 0.0300586, 0.0304591}, {
0.746098, 0.864134, 0.896798, 0.915206, 0.892908, 0.925542, 0.965535, 0.976817, 0.969621, 0.97947, 0.96053, 0.932026, 0.890304, 0.920358, 0.914331, 0.870453, 0.72379}, {
0.822019, 0.899872, 0.921555, 0.924149, 0.912558, 0.941316, 0.968864, 0.980897, 0.974751, 0.98205, 0.962961, 0.944326, 0.909539, 0.928872, 0.930499, 0.908397, 0.813926}, {
0.856485, 0.913669, 0.931294, 0.907726, 0.906485, 0.941792, 0.967712, 0.981397, 0.973845, 0.981301, 0.966708, 0.940502, 0.906667, 0.919455, 0.93831, 0.916848, 0.850154}, {
0.875239, 0.921039, 0.934574, 0.90753, 0.907931, 0.945337, 0.967368, 0.982558, 0.975641, 0.984347, 0.966008, 0.942053, 0.908449, 0.916216, 0.941678, 0.922614, 0.876428}, {
0.880127, 0.923893, 0.936408, 0.907229, 0.909954, 0.945526, 0.968553, 0.983551, 0.976461, 0.982765, 0.964381, 0.941373, 0.906338, 0.912369, 0.942583, 0.923028, 0.882534}, {
0.877576, 0.907883, 0.930454, 0.911715, 0.908074, 0.941773, 0.962457, 0.976348, 0.970981, 0.979376, 0.962818, 0.942426, 0.901337, 0.911817, 0.94469, 0.919188, 0.890979}, {
1.32627e-08, 1, 0.730778, 0.867473, 0.836652, 0.96416, 0.866008, 0.962264, 0.940671, 0.945241, 0.935868, 0.959226, 0.884371, 0.904762, 1, 1.86163e-10, 0.862535}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.000163314, 0.000191474, 0.000199677, 0.00110287, 4.84707e-06, 6.99367e-05, 3.08564e-05, 1.21381e-05, 1.25368e-05, 3.23348e-05, 5.29896e-05, 0.00013184, 6.48295e-05, 0.000116432, 0.000144033, 0.000162552, 0.000144592}, {
0.00468279, 0.00492199, 0.00495113, 0.00424765, 0.00324871, 0.00609583, 0.00317847, 0.00253376, 0.00149418, 0.00217362, 0.00321111, 0.00430132, 0.00345283, 0.00437985, 0.00386765, 0.00459153, 0.00472701}, {
0.00222957, 0.00204081, 0.00201809, 0.00193177, 0.00137858, 0.00184092, 0.00128524, 0.000948193, 0.000432165, 0.000951382, 0.00134804, 0.00156148, 0.00145578, 0.00185194, 0.00166197, 0.00178758, 0.00213149}, {
0.00143279, 0.00134738, 0.00130082, 0.0013491, 0.000878653, 0.000973531, 0.000739969, 0.00053709, 0.000303848, 0.000536145, 0.000760523, 0.00096839, 0.000923453, 0.00125539, 0.00110665, 0.00117593, 0.00138517}, {
0.00161605, 0.000866609, 0.0450344, 0.0558182, 0.0602252, 0.0388566, 0.000754274, 0.000524899, 0.000319471, 1.40905e-05, 0.0007732, 0.038822, 0.000858776, 0.00123949, 0.0315469, 0.00109485, 0.00100644}, {
0.00244662, 0.00259558, 0.0024125, 0.00255248, 4.22857e-06, 0.00194259, 0.0249706, 0.00111387, 0.0215255, 0.00108643, 0.0015643, 0.00187933, 0.00178601, 0.00260551, 1.06559e-06, 0.00255231, 0.00295785}, {
0.000218618, 0.00290651, 0.0039892, 0.0042629, 0.0027118, 0.00281279, 0.00228174, 0.00187742, 0.000898832, 0.00160432, 0.00234394, 0.00284667, 0.00293569, 0.0476931, 0.00327521, 0.0316186, 0.00418472}, {
0.306581, 0.169013, 0.164192, 0.0642459, 0.0477934, 0.0487715, 0.0610989, 0.0374391, 0.0139729, 0.0522282, 0.0594978, 0.04384, 0.0256848, 0.122733, 0.145425, 0.187582, 7.99789e-10}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
1.74149e-05, 2.17188e-05, 2.51827e-05, 2.34961e-05, 1.38394e-05, 2.75228e-05, 7.7178e-06, 5.49206e-06, 4.17205e-06, 3.29029e-06, 9.821e-06, 1.75535e-06, 9.3535e-06, 2.4667e-05, 2.42658e-05, 1.87942e-05, 1.75479e-05}, {
0.00107231, 0.00116479, 0.00109491, 2.14519e-05, 0.000788353, 0.00100205, 4.24256e-05, 0.000592061, 0.000298626, 0.000652701, 0.000747979, 0.000920976, 0.000795418, 0.00100104, 0.00101241, 0.00116813, 0.00106419}, {
0.000704188, 0.000709567, 0.000666094, 0.000645035, 0.000467279, 0.000536219, 0.000426494, 0.000292328, 4.63534e-05, 0.000315665, 0.000414486, 0.000554431, 0.000444725, 0.000625691, 0.000617543, 0.000686649, 0.000704848}, {
0.000490164, 0.000482592, 0.000445254, 0.000472739, 0.000311068, 0.000339402, 0.00025128, 0.000183738, 9.37458e-05, 0.000174076, 0.000257949, 0.0003438, 0.000303789, 0.000453393, 0.000400597, 0.00048074, 0.000491769}, {
1.71619e-05, 0.000474292, 0.000417981, 0.0593408, 0.00028835, 0.000321103, 0.000250091, 0.00018537, 9.43368e-05, 0.000108832, 0.000194268, 0.000327906, 0.000288814, 0.000396082, 0.000386029, 0.0504864, 0.0765821}, {
0.0011183, 0.000961035, 0.00087809, 0.00091395, 0.000597483, 0.000662088, 0.000514773, 0.000377012, 0.000195174, 0.00037736, 0.000533813, 0.000673864, 0.0600273, 0.000887301, 0.000809924, 0.000968637, 0.00109041}, {
0.0759832, 0.00179196, 0.00154013, 0.00154535, 0.0010085, 0.00113588, 0.000923305, 0.000713147, 0.000346061, 0.000644666, 0.000866768, 0.00110047, 0.00101808, 0.00150883, 0.00139999, 0.00174305, 0.00215134}, {
9.24838e-10, 0.0672417, 0.0408289, 0.0353007, 0.0200707, 0.018204, 0.0251002, 0.0113364, 0.00709442, 0.0176109, 0.022997, 0.0204588, 0.0152421, 0.026013, 0.0141846, 2.55248e-12, 0.0515316}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 //FIXME temporary protection
 if (index_pt == 0) index_pt = 1;

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.933777, 0.971823, 0.965146, 0.976513, 0.981442, 0.982751, 0.973586, 0.99194, 0.981311, 0.991635, 0.97597, 0.984129, 0.977921, 0.986679, 0.984026, 0.982249, 0.936727}, {
0.93528, 0.971226, 0.962924, 0.976812, 0.987363, 0.983581, 0.975392, 0.992929, 0.980925, 0.99455, 0.976688, 0.987145, 0.97971, 0.980246, 0.981565, 0.980938, 0.942915}, {
0.949449, 0.977902, 0.974807, 0.982364, 0.986033, 0.990226, 0.98234, 0.994028, 0.98508, 0.994552, 0.98221, 0.988077, 0.983897, 0.982996, 0.986704, 0.986065, 0.948472}, {
0.950483, 0.975877, 0.973381, 0.979942, 0.98424, 0.988314, 0.980505, 0.993509, 0.984014, 0.994384, 0.982061, 0.987039, 0.979533, 0.981324, 0.985846, 0.986148, 0.950661}, {
0.953154, 0.979473, 0.977145, 0.980176, 0.984056, 0.988133, 0.979552, 0.993595, 0.983354, 0.993865, 0.980157, 0.987966, 0.978585, 0.979719, 0.987508, 0.987499, 0.955196}, {
0.962394, 0.978401, 0.974649, 0.977541, 0.985771, 0.98775, 0.982721, 0.994096, 0.984505, 0.994446, 0.982896, 0.988621, 0.979204, 0.980907, 0.989469, 0.989217, 0.957042}, {
0.957779, 0.984637, 0.977777, 0.980879, 0.985957, 0.990521, 0.98649, 0.995171, 0.98851, 0.995838, 0.982364, 0.988748, 0.981651, 0.983791, 0.990999, 0.991674, 0.970404}, {
1, 0.857902, 1, 1, 1, 1, 0.965575, 1, 1, 1, 1, 0.97143, 1, 1, 1, 1, 2.86935e-09}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.558419, 0.589792, 0.630292, 0.685812, 0.789191, 0.892765, 0.925279, 0.943273, 0.957379, 0.947371, 0.917714, 0.899592, 0.786922, 0.688974, 0.646828, 0.594218, 0.546803}, {
0.89231, 0.935429, 0.950448, 0.963229, 0.971446, 0.982005, 0.985517, 0.994281, 0.989635, 0.994887, 0.982549, 0.982666, 0.968016, 0.965857, 0.958651, 0.94025, 0.882169}, {
0.927996, 0.960108, 0.967127, 0.970375, 0.979858, 0.987904, 0.986751, 0.994713, 0.990135, 0.995063, 0.9817, 0.987878, 0.97727, 0.972341, 0.970564, 0.963867, 0.925775}, {
0.939933, 0.967078, 0.97256, 0.971611, 0.981052, 0.988368, 0.98626, 0.995453, 0.990294, 0.995143, 0.983551, 0.98759, 0.978957, 0.974033, 0.975448, 0.970038, 0.936692}, {
0.9461, 0.969735, 0.973197, 0.973494, 0.982039, 0.989559, 0.986355, 0.995805, 0.990531, 0.996174, 0.983687, 0.987484, 0.979932, 0.974523, 0.97681, 0.971593, 0.945459}, {
0.943452, 0.969329, 0.974301, 0.971506, 0.981817, 0.988047, 0.98562, 0.995958, 0.990866, 0.994323, 0.983982, 0.986235, 0.978815, 0.972845, 0.974663, 0.968931, 0.943675}, {
0.932981, 0.954895, 0.964125, 0.969168, 0.975499, 0.980577, 0.981323, 0.990563, 0.98616, 0.990371, 0.978971, 0.980929, 0.971866, 0.966763, 0.970966, 0.957691, 0.934231}, {
1, 1, 0.933666, 0.935184, 0.933863, 1, 0.895755, 0.981131, 0.960686, 0.974955, 0.935868, 0.959226, 0.942018, 0.95238, 1, 9.50651e-07, 1}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0042092, 0.00345662, 0.00363225, 0.00277525, 0.00206632, 5.40662e-05, 0.00350555, 0.00202607, 0.00186607, 0.00223802, 0.00352067, 0.00252797, 0.00218823, 0.00236514, 0.00239527, 0.00235096, 0.00397202}, {
0.00332383, 0.00254199, 0.00333096, 0.00235229, 0.00140906, 0.00189099, 0.00259826, 0.00143893, 0.00105933, 0.00108872, 0.00229084, 0.00164971, 0.00166187, 0.00225283, 0.00222773, 0.00206309, 0.00317096}, {
0.00152157, 0.0011882, 1.3443e-05, 0.00106294, 0.000560998, 0.000781997, 0.000920537, 0.000478645, 0.000313527, 0.000557956, 0.000967264, 0.000783116, 0.000702542, 2.99727e-05, 0.000794174, 0.000946054, 0.00137367}, {
0.00103481, 0.000788245, 0.000811426, 0.000734981, 0.000368872, 0.000469991, 0.00038046, 0.000291366, 0.000281217, 0.00029442, 0.000499904, 0.000463534, 0.000441831, 0.000611251, 0.000399287, 0.00060822, 0.00101706}, {
0.00135767, 0.0142268, 0.000520185, 0.00010145, 0.000380414, 0.00325496, 0.000559564, 0.000207565, 0.000219555, 0.000223498, 0.000557991, 0.000462849, 0.000442369, 0.000454709, 0.000586286, 0.000571894, 0.00113577}, {
6.28356e-05, 0.00111633, 0.00167481, 0.015557, 0.000791919, 0.000938546, 0.00111821, 0.000643548, 0.00046218, 0.000594575, 0.001096, 0.000993223, 0.000877355, 0.00137803, 0.00117206, 0.00127717, 0.00210166}, {
0.00323377, 0.00182238, 0.0023328, 0.00244012, 0.00120279, 0.00127229, 0.00165883, 0.00104284, 0.000602679, 0.000489281, 0.00122872, 0.00164296, 0.0010039, 0.00213447, 0.00168873, 0.00188811, 3.81014e-05}, {
0.306581, 0.114949, 0.164192, 0.0836552, 0.0429367, 0.0623673, 0.0347782, 0.0374391, 0.000125574, 0.0522282, 0.0594978, 0.0291451, 0.0319523, 0.122733, 0.138179, 0.187582, 7.99789e-10}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.000922478, 0.00116881, 0.00130613, 0.00140783, 0.00110038, 0.00169105, 0.00181416, 0.00167915, 0.0008909, 0.00168812, 0.00175913, 0.00163889, 0.0011418, 0.0014405, 0.00129854, 0.0011743, 0.000898096}, {
0.000915606, 0.000884467, 0.000610052, 0.00073386, 0.000465222, 0.000552907, 0.000524969, 0.000360922, 0.000196918, 0.000363597, 0.000507108, 0.000470901, 0.000497487, 0.000718079, 0.000758731, 0.0397286, 0.000644551}, {
0.000535603, 0.000490099, 0.000463874, 0.000413635, 0.000251209, 0.00845142, 0.000287619, 0.000165013, 9.08545e-05, 0.000152432, 0.000299742, 0.000279115, 0.015708, 0.000421267, 0.000429284, 0.000478311, 0.000543056}, {
0.000366682, 0.000318612, 0.000300771, 0.000294925, 0.000158126, 0.000160161, 0.000107249, 9.47123e-05, 5.68498e-05, 9.18372e-05, 0.000130332, 0.000169575, 0.000170174, 0.000283179, 0.000261863, 0.000316804, 0.000371032}, {
0.000468593, 0.020754, 0.000270759, 0.000262408, 0.000142534, 0.000152795, 0.000163156, 0.000319661, 3.73753e-05, 0.00269697, 0.0113476, 0.000154952, 0.013906, 0.000259185, 0.000255696, 0.0195174, 0.0364639}, {
0.00080213, 0.000650431, 0.000601595, 0.000560279, 0.000304477, 0.00032917, 0.000356843, 0.000193808, 0.000125014, 0.000223051, 0.000371874, 0.00960246, 0.000327553, 0.000538052, 0.00056507, 0.000663952, 0.000856324}, {
0.0017378, 0.00138966, 0.00114927, 0.00099713, 0.0169054, 0.000710223, 0.00067307, 0.000472646, 0.000244113, 0.00675059, 0.000481823, 0.000662792, 0.000608101, 0.000714376, 0.00103504, 0.00134803, 0.0018315}, {
0.0504025, 0.0672417, 0.0275342, 0.027055, 0.0137521, 0.00665117, 0.0238751, 0.00832017, 0.00591744, 0.0311398, 0.022997, 0.0204588, 0.0118952, 0.0200263, 0.0141846, 1.92371e-07, 0.0334038}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
