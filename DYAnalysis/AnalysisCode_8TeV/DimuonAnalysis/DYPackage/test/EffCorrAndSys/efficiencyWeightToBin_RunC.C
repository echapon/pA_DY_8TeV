#include <TStyle.h>
#include <TChain.h>
#include <TFile.h>
#include <TH1D.h>
#include <TGraphAsymmErrors.h>
#include <TMultiGraph.h>
#include <TLegend.h>
#include <TCanvas.h>
#include <TROOT.h>
#include <THStack.h>
#include <TMath.h>
#include <TText.h>
#include <TPad.h>
#include <TPaveText.h>
#include <iostream>
#include <string>
#include <fstream>
#include <sstream>
#include <iomanip>
#include <vector>

using namespace std;

int Find_IndexRECOID( double muon_input, bool isPt )
{
 const int nptbins = 8;
 const int netabins = 20;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.5, -1.1, -0.9, -0.7, -0.5, -0.3, -0.1, 0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.5, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 30, 40, 50, 70, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}


double efficiency_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.972686, 1, 0.921873, 0.862929, 0.945076, 0.905476, 0.938882, 1, 0.827664, 0.95564, 0.721353, 0.912127, 0.915274, 0.948132, 1, 0.883327, 0.933726, 1, 1}, {
0.927201, 0.960565, 0.903113, 0.957126, 0.95543, 0.941436, 0.961079, 0.960655, 0.91201, 0.949295, 0.904577, 0.953565, 0.958104, 0.938353, 0.954171, 0.956708, 0.927438, 0.97061, 0.949941}, {
0.927839, 0.956867, 0.904271, 0.962659, 0.953228, 0.951755, 0.971142, 0.96972, 0.908291, 0.953706, 0.901623, 0.964999, 0.967029, 0.94616, 0.95124, 0.95589, 0.923205, 0.965693, 0.941522}, {
0.933196, 0.956866, 0.904218, 0.96357, 0.954325, 0.949769, 0.970655, 0.970356, 0.903832, 0.954645, 0.900959, 0.964267, 0.967501, 0.94365, 0.953712, 0.955994, 0.925011, 0.962062, 0.942515}, {
0.956136, 0.961522, 0.91788, 0.971706, 0.963148, 0.953173, 0.977965, 0.977058, 0.918971, 0.965142, 0.906164, 0.971149, 0.975639, 0.950462, 0.961453, 0.965659, 0.934229, 0.972613, 0.948936}, {
0.972294, 0.953033, 0.920156, 0.96579, 0.961631, 0.957016, 0.996451, 0.979742, 0.921289, 0.965361, 0.910927, 0.97599, 0.967247, 0.955943, 0.967829, 0.966006, 0.940796, 0.971651, 0.995053}, {
1.75214e-07, 3.23164e-07, 0.793088, 0.583706, 0.859229, 1, 0.948476, 0.999998, 0.807472, 0.760031, 0.87947, 0.833534, 1, 1, 1, 1, 0.833049, 5.9064e-08, 0.999367}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.942944, 0.975882, 0.9286, 0.95835, 0.95856, 0.957799, 0.964431, 0.963033, 0.938109, 0.96515, 0.935064, 0.977754, 0.978719, 0.92424, 0.957178, 0.961884, 0.938467, 0.974138, 0.949028}, {
0.945639, 0.970029, 0.920518, 0.964771, 0.960154, 0.95673, 0.977703, 0.978071, 0.925853, 0.966907, 0.923028, 0.975988, 0.975762, 0.956188, 0.960025, 0.960029, 0.935295, 0.970899, 0.948987}, {
0.947149, 0.966647, 0.918187, 0.966074, 0.96274, 0.958862, 0.979507, 0.977883, 0.926044, 0.969288, 0.920559, 0.976976, 0.976638, 0.957589, 0.962383, 0.959788, 0.934195, 0.968818, 0.948883}, {
0.948487, 0.965931, 0.919981, 0.96737, 0.964396, 0.957932, 0.978876, 0.977734, 0.925292, 0.969803, 0.91987, 0.977016, 0.977668, 0.957515, 0.962664, 0.960881, 0.933781, 0.967829, 0.951613}, {
0.951997, 0.966758, 0.923146, 0.973455, 0.965005, 0.959369, 0.983084, 0.981244, 0.926277, 0.973501, 0.923557, 0.97876, 0.980127, 0.958611, 0.966597, 0.96519, 0.934767, 0.966831, 0.955564}, {
0.955541, 0.962785, 0.923725, 0.980248, 0.970107, 0.96081, 0.983632, 0.982307, 0.929727, 0.978036, 0.921564, 0.982064, 0.978855, 0.959267, 0.96693, 0.97127, 0.92637, 0.967037, 0.95198}, {
1.99008e-07, 4.86178e-06, 0.717831, 0.96084, 0.979007, 1, 1, 1, 0.873783, 0.999999, 0.793452, 1, 0.9251, 1, 0.934285, 0.833715, 0.487467, 1.39908e-10, 0.999989}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_RECOID( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 8;
 const int netabins = 20;
 index_pt = Find_IndexRECOID(muon_pt, true);
 index_eta = Find_IndexRECOID(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0265044, 0.0034096, 0.0525895, 0.0169254, 0.0326568, 0.0329612, 0.0497192, 0.0210637, 0.040485, 0.0479869, 0.0269657, 0.0433734, 0.0418025, 0.0374353, 0.0157632, 0.018142, 0.0199553, 0.00719142, 0.00927374}, {
0.0477754, 0.00276642, 0.00202386, 0.00210043, 0.00285406, 0.00276177, 0.00274762, 0.0027304, 0.00278183, 0.00267653, 0.00275339, 0.00277009, 0.00274878, 0.00280204, 0.00285421, 0.00209926, 0.00196339, 0.00264468, 0.00298751}, {
0.00142951, 0.00122855, 0.00102061, 0.00080108, 0.0010387, 0.000965704, 0.000842052, 0.000832489, 0.00106083, 0.000916836, 0.00106564, 0.000855975, 0.000859127, 0.000992306, 0.00104834, 0.000824885, 0.000951414, 0.00114576, 0.00135446}, {
0.00115349, 0.000962514, 0.000770372, 0.000548346, 0.000764459, 0.0007627, 0.000653027, 0.000660351, 0.000920664, 0.000767079, 0.000925568, 0.000699083, 0.000675376, 0.000789946, 0.000771972, 0.000576272, 0.000714112, 0.000902683, 0.00108024}, {
0.0040869, 0.00292241, 0.00206883, 0.00166681, 0.0020712, 0.00206996, 0.00129993, 0.00187944, 0.00232544, 0.0020566, 0.00232596, 0.0019514, 0.00188606, 8.54328e-06, 0.00211582, 0.00168226, 0.00192823, 0.00269581, 0.00267726}, {
0.017257, 0.00902436, 0.00585985, 0.00530955, 0.00568786, 0.00521097, 0.00444108, 0.00521818, 0.00582654, 0.00586865, 0.00560852, 0.00545548, 0.00519952, 0.00529481, 0.00579326, 0.0036728, 0.00559184, 0.00883183, 0.000273872}, {
7.50694e-09, 3.99211e-08, 0.187936, 0.0812308, 0.128697, 0.141879, 0.174509, 0.768745, 0.140166, 0.158402, 0.00797433, 0.202139, 0.148218, 0.090102, 0.122086, 0.177217, 0.206775, 1.98887e-08, 0.211614}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00347853, 0.00400481, 0.00291337, 0.00370008, 0.00664951, 0.00813665, 0.010317, 0.0130726, 0.0152865, 0.0176676, 0.0149555, 0.0134092, 0.0105374, 0.049818, 0.0064829, 0.00372424, 0.00296282, 0.00378334, 0.0342931}, {
0.00105728, 0.00101802, 0.000917005, 0.000764115, 0.00104442, 0.00109225, 2.85132e-05, 0.000959531, 3.44747e-06, 0.00104726, 1.03829e-05, 0.000969934, 0.000971902, 0.00109026, 0.0010829, 0.000780826, 0.000862295, 0.000982101, 0.00103053}, {
0.00078938, 0.000738452, 0.000689666, 0.000478698, 0.00062544, 0.000606619, 0.000455136, 0.000459706, 0.000698437, 0.000512194, 0.000710352, 0.00045685, 0.000474377, 0.000605593, 0.000626819, 0.000509168, 0.000635268, 0.000712231, 0.000776743}, {
0.000713004, 0.000624358, 0.000552518, 0.000365893, 0.000508376, 0.00121162, 0.000399529, 0.000409026, 0.000645529, 0.000465054, 0.000662342, 0.0158814, 0.000407713, 0.00052566, 0.000518557, 0.000393774, 0.000512238, 0.000608658, 0.000699825}, {
0.00755189, 0.00161266, 0.00131585, 0.000896209, 0.00123379, 0.00119572, 0.000919071, 0.000940511, 0.00144033, 0.00107933, 0.00146588, 0.000950411, 0.000948048, 1.58119e-05, 3.5942e-05, 0.000975052, 0.00122513, 0.00158235, 0.0300572}, {
0.00499108, 0.00520864, 0.00338234, 0.0023709, 0.00291794, 0.026701, 0.00233831, 0.00229989, 0.00327849, 0.00261945, 0.00333523, 0.0023981, 0.00238758, 0.00282582, 0.00290958, 0.00238413, 0.003115, 0.00493767, 0.000384794}, {
3.21428e-08, 1.31475e-06, 0.140548, 0.0910586, 0.108686, 0.0669069, 0.0201737, 0.000906876, 0.126459, 0.0690475, 0.0971189, 0.0673858, 0.0811154, 0.0413695, 0.0936633, 0.0925321, 0.0664068, 1.28087e-11, 0.620917}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
int Find_Index( double muon_input, bool isPt )
{
 const int nptbins = 9;
 const int netabins = 18;
   Double_t eta_bin[netabins] = {-2.4, -2.1, -1.9, -1.7, -1.5, -1.1, -0.9, -0.7, -0.5, 0.5, 0.7, 0.9, 1.1, 1.5, 1.7, 1.9, 2.1, 2.4};
   Double_t pt_bin[nptbins] = {8, 17, 22, 30, 40, 50, 65, 250, 500};
   int Index = -1;

  if( isPt ) {
    for( int i = 0; i < nptbins-1; i++ ) {
      if( muon_input > pt_bin[i] && muon_input < pt_bin[i+1] ) {
             Index = i;
             break;
      }
      else if( muon_input > pt_bin[nptbins-1] ) Index = nptbins-2; //out of bounds
    }
    return Index;
  } else {
    for( int i = 0; i < netabins-1; i++ ) {
      if( muon_input > eta_bin[i] && muon_input < eta_bin[i+1] ) {
          Index = i; 
          break;
       }
    }
    return Index;
  }
}

double efficiency_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.909892, 0.924657, 0.917443, 0.897855, 0.902211, 0.919444, 0.909427, 0.900689, 0.87403, 0.912818, 0.908295, 0.914076, 0.896786, 0.897353, 0.914733, 0.924543, 0.915127}, {
0.962944, 0.960797, 0.949476, 0.949873, 0.946542, 0.951051, 0.949717, 0.934719, 0.926355, 0.940357, 0.948034, 0.950242, 0.946933, 0.946031, 0.957865, 0.959494, 0.959755}, {
0.980571, 0.983048, 0.980632, 0.978796, 0.977659, 0.976135, 0.976249, 0.974775, 0.976312, 0.975815, 0.974762, 0.975885, 0.977799, 0.977394, 0.982183, 0.983409, 0.981154}, {
0.990998, 0.991032, 0.991965, 0.990334, 0.990351, 0.99019, 0.990452, 0.990428, 0.990175, 0.990131, 0.990027, 0.990269, 0.989581, 0.989597, 0.991143, 0.992352, 0.990796}, {
0.99544, 0.99666, 0.996549, 0.996983, 0.996848, 0.996277, 0.995549, 0.996248, 0.995556, 0.995707, 0.995952, 0.99643, 0.996918, 0.996459, 0.995763, 0.996709, 0.995632}, {
0.996414, 0.997378, 0.996403, 0.998355, 0.997153, 0.996984, 0.997165, 0.996357, 0.996956, 0.997161, 0.996698, 0.997437, 0.997025, 0.997551, 0.997796, 0.996933, 0.996537}, {
0.997475, 0.997905, 0.996796, 0.997269, 0.997218, 0.998783, 0.998189, 0.997797, 0.997966, 0.997713, 0.998192, 0.998345, 0.998065, 0.998576, 0.997279, 0.997483, 0.995361}, {
1, 1, 1, 1, 1, 1, 1, 1, 0.991557, 1, 1, 1, 0.978011, 1, 1, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.92605, 0.931812, 0.925406, 0.927039, 0.931543, 0.929617, 0.929129, 0.924431, 0.903358, 0.918551, 0.924672, 0.92813, 0.927919, 0.926916, 0.931634, 0.941097, 0.931912}, {
0.967487, 0.96798, 0.962345, 0.96418, 0.963936, 0.959803, 0.961133, 0.957942, 0.947975, 0.960568, 0.962915, 0.960071, 0.962208, 0.960628, 0.968396, 0.967213, 0.967775}, {
0.981695, 0.982189, 0.980191, 0.977271, 0.976248, 0.974877, 0.974897, 0.976413, 0.977208, 0.976585, 0.975553, 0.973951, 0.976862, 0.97805, 0.981787, 0.982854, 0.983319}, {
0.99079, 0.991864, 0.99093, 0.990326, 0.989659, 0.989554, 0.990409, 0.990044, 0.990779, 0.990567, 0.990267, 0.989702, 0.989807, 0.989614, 0.990956, 0.992058, 0.991357}, {
0.995572, 0.997296, 0.99701, 0.99747, 0.997174, 0.996974, 0.996865, 0.996989, 0.997092, 0.996969, 0.996896, 0.996681, 0.997089, 0.997249, 0.997181, 0.997628, 0.995836}, {
0.996706, 0.99821, 0.998392, 0.998497, 0.998525, 0.997839, 0.998738, 0.998393, 0.998329, 0.99824, 0.998224, 0.998415, 0.998753, 0.99893, 0.998217, 0.998271, 0.997206}, {
0.997995, 0.997642, 0.998837, 0.9993, 0.998865, 0.999223, 0.998967, 0.998619, 0.998674, 0.999343, 0.998645, 0.999003, 0.998656, 0.999628, 0.998567, 0.998665, 0.996357}, {
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_ISO( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.00416704, 0.00490781, 0.00499603, 0.00530176, 0.00380501, 0.00574034, 0.00660364, 0.007428, 0.00406555, 0.00786083, 0.0067236, 0.0056703, 0.00394232, 0.00526198, 0.00499023, 0.00464522, 0.00407472}, {
0.00252438, 0.00291552, 0.00325575, 0.00327726, 0.00237482, 0.00323898, 0.00316856, 0.00363775, 0.00204258, 0.00349095, 0.00333847, 0.00335882, 0.00238271, 0.00345912, 0.00303876, 0.00310757, 0.00246777}, {
0.000965312, 0.000953018, 0.00102914, 0.00107172, 0.000729241, 0.00102938, 0.00137315, 0.000984308, 0.000417505, 0.000992404, 0.00103638, 0.00103739, 0.000728998, 0.00106958, 0.000961144, 0.000919201, 0.000942387}, {
0.000433883, 0.000448908, 0.000451353, 0.000465233, 0.000295364, 0.00038514, 0.000372729, 0.000345986, 0.000155153, 0.000354229, 0.000369219, 0.000386898, 0.000310264, 0.000467107, 0.000442956, 0.000426573, 0.000428534}, {
4.3449e-05, 4.27774e-06, 0.00243985, 0.000244066, 0.000160833, 0.000236741, 0.000243652, 0.000228725, 0.000110758, 0.000232756, 0.000235949, 0.000231026, 0.000156372, 0.000257755, 0.00299004, 0.000283645, 0.000230741}, {
0.002728, 2.00267e-05, 0.000405164, 0.000395656, 0.000321049, 0.000455085, 0.000466024, 0.000461225, 0.000195819, 0.000428759, 0.000477818, 0.000405181, 0.000316919, 0.000291716, 0.000482419, 0.000580713, 0.000671929}, {
0.00091847, 0.000960429, 0.00078985, 0.000548186, 0.000351513, 0.000573951, 0.000649632, 0.000672931, 0.000272402, 0.000624956, 0.000605903, 0.000633227, 0.000502399, 0.000686155, 0.000816892, 0.000962739, 0.000238266}, {
0.707107, 0.497795, 0.190564, 0.101005, 0.00848699, 0.0354122, 0.0327135, 0.0313281, 0.00967101, 0.0312774, 0.0316458, 0.0516798, 0.0229807, 0.098013, 0.158258, 0.14307, 0.218645}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.00172552, 0.00204409, 0.00207168, 0.00230309, 0.00170802, 0.00290861, 0.00332692, 0.00394054, 0.00238587, 0.00342713, 0.00348185, 0.00286958, 0.00181107, 0.00229226, 0.00210792, 0.00196947, 0.00168822}, {
0.00121982, 0.00142423, 0.00155948, 0.00155012, 0.00107305, 0.00159422, 0.00175939, 0.0018986, 0.00108376, 0.00178099, 0.00166494, 0.0015915, 0.00110399, 0.00158836, 0.00145759, 0.00142613, 0.00122667}, {
0.000633888, 0.000734028, 0.000789093, 0.000816653, 0.00056012, 0.000764487, 0.000785082, 0.00072352, 0.000311362, 0.000733322, 0.000772861, 0.000809311, 0.000555546, 0.000816287, 0.000745707, 0.000721698, 0.000611924}, {
0.000323162, 0.00035442, 0.000380882, 0.000376314, 0.000242328, 0.000317023, 0.000296657, 0.000284159, 0.000120895, 0.000278152, 0.000301687, 0.000321441, 0.000244332, 0.000385917, 0.000371282, 0.000357301, 0.000314774}, {
0.000152062, 0.000202504, 0.00013932, 0.000182474, 0.000773587, 0.000170145, 0.000168683, 0.000161847, 7.12934e-05, 0.000171197, 0.00016507, 0.000174371, 0.000122993, 0.00042939, 0.00199327, 0.000192162, 0.000241653}, {
9.53682e-07, 0.000370563, 0.000300443, 0.000323953, 0.000178421, 2.67757e-05, 0.000240126, 0.000246641, 0.000113109, 0.000255436, 0.00026717, 0.000254607, 0.000320553, 0.000286664, 0.000336849, 0.00124979, 0.000415894}, {
0.000806703, 0.00066586, 0.000510666, 0.000435752, 0.000273622, 0.000601651, 0.000341644, 0.000310029, 0.00010921, 0.000291815, 0.000339668, 0.000275132, 0.000260401, 0.000357712, 0.000267476, 0.0005361, 0.00261643}, {
0.465797, 0.290834, 0.0791033, 0.070792, 0.0211983, 0.0391113, 0.0332353, 0.0215364, 0.00621946, 0.0249117, 0.0350299, 0.0498599, 0.0178477, 0.0677456, 0.144902, 0.542269, 0.353704}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0395999, 0.0420108, 0.0415624, 0.0330232, 0.0211083, 0.0230842, 0.0129277, 0.0105849, 0.0100353, 0.0108873, 0.0125859, 0.0166036, 0.0235581, 0.0371107, 0.0398414, 0.0393992, 0.0405685}, {
0.804606, 0.894481, 0.895046, 0.917579, 0.904274, 0.930816, 0.958207, 0.97956, 0.96777, 0.980139, 0.955398, 0.935916, 0.890686, 0.931744, 0.928202, 0.916725, 0.819021}, {
0.869297, 0.922058, 0.929188, 0.945008, 0.925491, 0.949853, 0.964952, 0.982608, 0.972424, 0.983581, 0.967294, 0.949428, 0.919428, 0.946124, 0.957697, 0.945362, 0.882454}, {
0.877632, 0.923503, 0.927608, 0.927494, 0.913491, 0.943153, 0.963796, 0.98104, 0.969011, 0.982111, 0.964594, 0.942463, 0.90396, 0.932345, 0.9568, 0.948939, 0.89425}, {
0.890389, 0.926545, 0.932705, 0.92783, 0.915249, 0.940617, 0.960214, 0.980699, 0.969204, 0.981973, 0.963135, 0.943064, 0.903092, 0.930328, 0.957386, 0.947822, 0.905616}, {
0.899743, 0.933008, 0.938882, 0.930608, 0.917444, 0.946939, 0.965276, 0.981829, 0.97096, 0.98179, 0.965886, 0.944048, 0.907515, 0.934105, 0.963162, 0.958366, 0.920226}, {
0.925483, 0.945624, 0.947973, 0.937905, 0.931047, 0.956107, 0.970518, 0.982317, 0.973631, 0.982729, 0.973471, 0.955034, 0.919275, 0.947306, 0.969226, 0.963987, 0.931145}, {
1, 1, 1, 1, 0.892703, 0.891899, 0.921197, 0.945722, 0.955877, 1, 1, 0.96, 0.998903, 1, 1, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.0309008, 0.0306183, 0.0351872, 0.0329851, 0.0259252, 0.0297483, 0.0106486, 0.00908909, 0.0098601, 0.00624535, 0.0131924, 0.0267205, 0.0263026, 0.0329684, 0.0345903, 0.0300586, 0.0304591}, {
0.746098, 0.864134, 0.896798, 0.915206, 0.892908, 0.925542, 0.965535, 0.976817, 0.969621, 0.97947, 0.96053, 0.932026, 0.890304, 0.920358, 0.914331, 0.870453, 0.72379}, {
0.822019, 0.899872, 0.921555, 0.924149, 0.912558, 0.941316, 0.968864, 0.980897, 0.974751, 0.98205, 0.962961, 0.944326, 0.909539, 0.928872, 0.930499, 0.908397, 0.813926}, {
0.856485, 0.913669, 0.931294, 0.907726, 0.906485, 0.941792, 0.967712, 0.981397, 0.973845, 0.981301, 0.966708, 0.940502, 0.906667, 0.919455, 0.93831, 0.916848, 0.850154}, {
0.875239, 0.921039, 0.934574, 0.90753, 0.907931, 0.945337, 0.967368, 0.982558, 0.975641, 0.984347, 0.966008, 0.942053, 0.908449, 0.916216, 0.941678, 0.922614, 0.876428}, {
0.880127, 0.923893, 0.936408, 0.907229, 0.909954, 0.945526, 0.968553, 0.983551, 0.976461, 0.982765, 0.964381, 0.941373, 0.906338, 0.912369, 0.942583, 0.923028, 0.882534}, {
0.877576, 0.907883, 0.930454, 0.911715, 0.908074, 0.941773, 0.962457, 0.976348, 0.970981, 0.979376, 0.962818, 0.942426, 0.901337, 0.911817, 0.94469, 0.919188, 0.890979}, {
1.32627e-08, 1, 0.730778, 0.867473, 0.836652, 0.96416, 0.866008, 0.962264, 0.940671, 0.945241, 0.935868, 0.959226, 0.884371, 0.904762, 1, 1.86163e-10, 0.862535}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_Mu17leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.000111305, 0.000133439, 0.000147437, 0.000106965, 3.98642e-05, 0.000108273, 2.56087e-05, 2.01345e-05, 1.25335e-05, 2.21456e-05, 3.02053e-05, 3.94452e-05, 4.69013e-05, 0.00012775, 0.00014098, 0.000131543, 0.000113508}, {
0.00405421, 0.00403499, 0.0041663, 0.00358028, 0.0028167, 0.00350316, 0.00255462, 0.00182041, 0.00110599, 0.00179868, 0.00259189, 0.00343079, 0.00294565, 0.0039087, 0.00352285, 0.00380854, 0.00390893}, {
0.0018343, 0.00176414, 0.00168643, 0.00153721, 0.00117075, 0.00135857, 0.00106568, 0.00081816, 1.01883e-06, 0.000759451, 0.00114093, 0.0013688, 0.00121964, 0.00149227, 0.00121667, 0.00149513, 0.00178075}, {
0.00121691, 0.00115565, 0.00109809, 0.00103414, 0.000745091, 0.00078463, 0.000639707, 0.00043151, 0.000240906, 0.000477782, 0.000651082, 0.000825427, 0.000775845, 0.00100133, 0.000861555, 0.000980021, 0.00115696}, {
0.069017, 0.00117826, 0.00105453, 0.000986502, 2.05347e-05, 0.00083149, 0.000672394, 0.0133886, 0.0211062, 0.000449831, 5.53318e-05, 0.000800087, 0.00071842, 0.000972563, 0.00084649, 0.000927376, 0.00116571}, {
5.82511e-06, 0.00226305, 0.00193807, 0.0456831, 0.00095046, 0.0355468, 0.00135064, 0.000917536, 0.0199415, 0.000973513, 0.00132605, 0.00164635, 0.00146882, 0.0435471, 0.00169369, 0.00188974, 0.05196}, {
0.0488694, 0.00365912, 0.00343051, 0.00327361, 0.00218077, 0.00251521, 0.00203263, 0.00148467, 0.000809569, 0.00149155, 0.00198586, 0.00241057, 0.00238064, 0.00291701, 0.00266692, 0.00304085, 0.00435564}, {
0.707107, 0.618615, 0.190564, 0.0937761, 0.0411386, 0.0458691, 0.0408237, 0.036301, 0.0161438, 0.0378605, 0.0486, 0.0398742, 0.0204133, 0.0294327, 0.133108, 0.156562, 0.426662}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
1.74149e-05, 2.17188e-05, 2.51827e-05, 2.34961e-05, 1.38394e-05, 2.75228e-05, 7.7178e-06, 5.49206e-06, 4.17205e-06, 3.29029e-06, 9.821e-06, 1.75535e-06, 9.3535e-06, 2.4667e-05, 2.42658e-05, 1.87942e-05, 1.75479e-05}, {
0.00107231, 0.00116479, 0.00109491, 2.14519e-05, 0.000788353, 0.00100205, 4.24256e-05, 0.000592061, 0.000298626, 0.000652701, 0.000747979, 0.000920976, 0.000795418, 0.00100104, 0.00101241, 0.00116813, 0.00106419}, {
0.000704188, 0.000709567, 0.000666094, 0.000645035, 0.000467279, 0.000536219, 0.000426494, 0.000292328, 4.63534e-05, 0.000315665, 0.000414486, 0.000554431, 0.000444725, 0.000625691, 0.000617543, 0.000686649, 0.000704848}, {
0.000490164, 0.000482592, 0.000445254, 0.000472739, 0.000311068, 0.000339402, 0.00025128, 0.000183738, 9.37458e-05, 0.000174076, 0.000257949, 0.0003438, 0.000303789, 0.000453393, 0.000400597, 0.00048074, 0.000491769}, {
1.71619e-05, 0.000474292, 0.000417981, 0.0593408, 0.00028835, 0.000321103, 0.000250091, 0.00018537, 9.43368e-05, 0.000108832, 0.000194268, 0.000327906, 0.000288814, 0.000396082, 0.000386029, 0.0504864, 0.0765821}, {
0.0011183, 0.000961035, 0.00087809, 0.00091395, 0.000597483, 0.000662088, 0.000514773, 0.000377012, 0.000195174, 0.00037736, 0.000533813, 0.000673864, 0.0600273, 0.000887301, 0.000809924, 0.000968637, 0.00109041}, {
0.0759832, 0.00179196, 0.00154013, 0.00154535, 0.0010085, 0.00113588, 0.000923305, 0.000713147, 0.000346061, 0.000644666, 0.000866768, 0.00110047, 0.00101808, 0.00150883, 0.00139999, 0.00174305, 0.00215134}, {
9.24838e-10, 0.0672417, 0.0408289, 0.0353007, 0.0200707, 0.018204, 0.0251002, 0.0113364, 0.00709442, 0.0176109, 0.022997, 0.0204588, 0.0152421, 0.026013, 0.0141846, 2.55248e-12, 0.0515316}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
double efficiency_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 //FIXME temporary protection
 if (index_pt == 0) index_pt = 1;

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.932512, 0.963841, 0.961165, 0.977801, 0.983035, 0.984325, 0.976246, 0.990263, 0.985235, 0.996659, 0.9787, 0.984007, 0.98084, 0.984725, 0.980562, 0.976476, 0.930036}, {
0.941795, 0.972257, 0.966638, 0.981014, 0.987561, 0.989458, 0.978529, 0.993735, 0.982748, 0.994299, 0.976589, 0.987883, 0.983515, 0.982319, 0.983083, 0.977715, 0.943127}, {
0.949835, 0.973542, 0.974033, 0.985317, 0.988814, 0.989841, 0.982163, 0.995608, 0.984906, 0.995594, 0.983657, 0.990062, 0.985232, 0.98731, 0.986571, 0.984968, 0.951417}, {
0.948329, 0.97303, 0.971492, 0.980964, 0.985536, 0.987867, 0.980631, 0.994313, 0.984561, 0.994373, 0.981632, 0.987415, 0.981775, 0.984741, 0.985198, 0.984782, 0.952223}, {
0.952013, 0.973733, 0.974715, 0.981191, 0.985768, 0.987794, 0.978929, 0.993617, 0.983583, 0.99452, 0.980876, 0.987026, 0.982402, 0.983506, 0.986365, 0.985224, 0.954469}, {
0.951708, 0.975616, 0.976164, 0.984043, 0.986979, 0.988421, 0.981249, 0.99421, 0.985543, 0.995239, 0.983666, 0.988425, 0.981954, 0.985448, 0.989174, 0.988137, 0.96176}, {
0.971154, 0.978267, 0.979505, 0.982726, 0.988903, 0.9907, 0.985216, 0.994897, 0.987104, 0.994344, 0.98731, 0.990333, 0.986453, 0.989108, 0.989917, 0.989586, 0.962949}, {
1, 1, 1, 1, 0.937874, 0.94601, 0.947454, 0.972873, 0.974918, 1, 1, 1, 1, 1, 1, 1, 1}};

 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.558419, 0.589792, 0.630292, 0.685812, 0.789191, 0.892765, 0.925279, 0.943273, 0.957379, 0.947371, 0.917714, 0.899592, 0.786922, 0.688974, 0.646828, 0.594218, 0.546803}, {
0.89231, 0.935429, 0.950448, 0.963229, 0.971446, 0.982005, 0.985517, 0.994281, 0.989635, 0.994887, 0.982549, 0.982666, 0.968016, 0.965857, 0.958651, 0.94025, 0.882169}, {
0.927996, 0.960108, 0.967127, 0.970375, 0.979858, 0.987904, 0.986751, 0.994713, 0.990135, 0.995063, 0.9817, 0.987878, 0.97727, 0.972341, 0.970564, 0.963867, 0.925775}, {
0.939933, 0.967078, 0.97256, 0.971611, 0.981052, 0.988368, 0.98626, 0.995453, 0.990294, 0.995143, 0.983551, 0.98759, 0.978957, 0.974033, 0.975448, 0.970038, 0.936692}, {
0.9461, 0.969735, 0.973197, 0.973494, 0.982039, 0.989559, 0.986355, 0.995805, 0.990531, 0.996174, 0.983687, 0.987484, 0.979932, 0.974523, 0.97681, 0.971593, 0.945459}, {
0.943452, 0.969329, 0.974301, 0.971506, 0.981817, 0.988047, 0.98562, 0.995958, 0.990866, 0.994323, 0.983982, 0.986235, 0.978815, 0.972845, 0.974663, 0.968931, 0.943675}, {
0.932981, 0.954895, 0.964125, 0.969168, 0.975499, 0.980577, 0.981323, 0.990563, 0.98616, 0.990371, 0.978971, 0.980929, 0.971866, 0.966763, 0.970966, 0.957691, 0.934231}, {
1, 1, 0.933666, 0.935184, 0.933863, 1, 0.895755, 0.981131, 0.960686, 0.974955, 0.935868, 0.959226, 0.942018, 0.95238, 1, 9.50651e-07, 1}};

  if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
  else return recoid_eff_data[index_pt][index_eta];
}


double efficiencyError_TRIG_TkMu8leg( double muon_pt, double muon_eta, bool isMC , TString runSplit) {
 int index_pt = -1;
 int index_eta = -1;

 const int nptbins = 9;
 const int netabins = 18;
 index_pt = Find_Index(muon_pt, true);
 index_eta = Find_Index(muon_eta, false);

 double recoid_eff_data[nptbins-1][netabins-1] = {{
0.0035125, 0.00318567, 0.00308724, 0.00238057, 0.00150635, 0.00210539, 0.00271521, 0.00697207, 0.00144056, 0.00144825, 0.00283882, 0.00240951, 0.00176007, 0.00223546, 0.00246605, 0.00244314, 0.0031868}, {
0.00286642, 0.00240907, 0.00260239, 0.00196814, 0.00116729, 0.00184574, 0.00203091, 0.00115165, 0.000873938, 0.00103437, 0.00188112, 0.00136406, 0.00167591, 0.00183454, 0.00184429, 0.00209558, 0.00265634}, {
0.00130785, 0.00111454, 0.00105284, 0.000834198, 0.000508339, 0.000671862, 0.000753996, 0.000430169, 0.000270069, 0.000428501, 0.000834349, 0.000653839, 0.000575655, 0.000768125, 0.00069076, 0.000856568, 0.00129568}, {
0.00088627, 0.000743898, 0.000717641, 0.000542714, 0.000343785, 0.000398967, 0.000345524, 0.000184216, 0.00017572, 0.00395994, 0.000482442, 0.000402847, 0.000386604, 0.000546911, 0.000483106, 0.000533652, 0.00085919}, {
0.000668996, 0.000494666, 0.000688017, 0.000546246, 0.000312982, 0.000415594, 0.000491457, 0.000247921, 0.000187047, 0.000177016, 0.000476036, 0.000978775, 0.000363461, 0.000481824, 0.00951659, 3.80504e-07, 0.000870614}, {
0.00196326, 0.00153511, 0.00136645, 0.00100807, 0.000603982, 0.000814023, 0.00100199, 2.23146e-05, 0.000392944, 0.000514932, 0.000959204, 0.00081866, 0.000731625, 0.0101659, 0.000986445, 0.00110277, 0.00185702}, {
0.00351365, 0.0024139, 0.00231195, 0.00184184, 0.000959993, 0.00120785, 0.00148918, 0.000868943, 0.000570376, 0.000803181, 0.0013616, 0.00123438, 0.00118112, 0.00102825, 0.00163198, 0.00176298, 0.000117068}, {
0.707107, 0.618615, 0.190564, 0.0937761, 0.035133, 0.0361426, 0.0352182, 0.0277709, 0.0128119, 0.0378605, 0.0486, 0.0504264, 0.0284486, 0.0937761, 0.133108, 0.156562, 0.426662}};


 double recoid_eff_mc[nptbins-1][netabins-1] = {{
0.000922478, 0.00116881, 0.00130613, 0.00140783, 0.00110038, 0.00169105, 0.00181416, 0.00167915, 0.0008909, 0.00168812, 0.00175913, 0.00163889, 0.0011418, 0.0014405, 0.00129854, 0.0011743, 0.000898096}, {
0.000915606, 0.000884467, 0.000610052, 0.00073386, 0.000465222, 0.000552907, 0.000524969, 0.000360922, 0.000196918, 0.000363597, 0.000507108, 0.000470901, 0.000497487, 0.000718079, 0.000758731, 0.0397286, 0.000644551}, {
0.000535603, 0.000490099, 0.000463874, 0.000413635, 0.000251209, 0.00845142, 0.000287619, 0.000165013, 9.08545e-05, 0.000152432, 0.000299742, 0.000279115, 0.015708, 0.000421267, 0.000429284, 0.000478311, 0.000543056}, {
0.000366682, 0.000318612, 0.000300771, 0.000294925, 0.000158126, 0.000160161, 0.000107249, 9.47123e-05, 5.68498e-05, 9.18372e-05, 0.000130332, 0.000169575, 0.000170174, 0.000283179, 0.000261863, 0.000316804, 0.000371032}, {
0.000468593, 0.020754, 0.000270759, 0.000262408, 0.000142534, 0.000152795, 0.000163156, 0.000319661, 3.73753e-05, 0.00269697, 0.0113476, 0.000154952, 0.013906, 0.000259185, 0.000255696, 0.0195174, 0.0364639}, {
0.00080213, 0.000650431, 0.000601595, 0.000560279, 0.000304477, 0.00032917, 0.000356843, 0.000193808, 0.000125014, 0.000223051, 0.000371874, 0.00960246, 0.000327553, 0.000538052, 0.00056507, 0.000663952, 0.000856324}, {
0.0017378, 0.00138966, 0.00114927, 0.00099713, 0.0169054, 0.000710223, 0.00067307, 0.000472646, 0.000244113, 0.00675059, 0.000481823, 0.000662792, 0.000608101, 0.000714376, 0.00103504, 0.00134803, 0.0018315}, {
0.0504025, 0.0672417, 0.0275342, 0.027055, 0.0137521, 0.00665117, 0.0238751, 0.00832017, 0.00591744, 0.0311398, 0.022997, 0.0204588, 0.0118952, 0.0200263, 0.0141846, 1.92371e-07, 0.0334038}};

   if ( isMC ) return recoid_eff_mc[index_pt][index_eta];
   else return recoid_eff_data[index_pt][index_eta];

}
