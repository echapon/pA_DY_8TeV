/*
1) There is a natural factor of 2 for the FEWZ cross section obtained with histogramming lost
2) Can be cross checked to 1D and better have a good agreement
3) The MC numbers from POWHEG should be obtained before the selection/acceptance for pre-FSR, normalized to Lumi
*/
void filterNegatives(TH2D* h);
void plotCOLZ(TH2D* h2);
void printWeightMap(TH2D* h);

double FEWPOW_weightPreparer(void) {

 const int nptbins = 21;
 const int nrapbins = 8;

 //Get (arbitrarily normalized POWHEG denominator)
 //Produced by EventSelector on GEN level pre-FSR quantities 
 TFile* fPOW = new TFile("./rootfiles/DYM_40mass8rap.root");
 fPOW->cd();
 TH2D* xsecPOW_1520bin = (TH2D*)xsec_1520bin->Clone();
 TH2D* xsecPOW_2030bin = (TH2D*)xsec_2030bin->Clone();
 TH2D* xsecPOW_72106bin = (TH2D*)xsec_60120bin->Clone();
 TH2D* xsecPOW_4001500bin = (TH2D*)xsec_3001500bin->Clone();
 TH2D* xsecPOW_3045bin = (TH2D*)xsec_3045bin->Clone();
 TH2D* xsecPOW_4560bin = (TH2D*)xsec_4560bin->Clone();
 TH2D* xsecPOW_6072bin = (TH2D*)xsec_6072bin->Clone();
 TH2D* xsecPOW_106120bin = (TH2D*)xsec_106120bin->Clone();
 TH2D* xsecPOW_120133bin = (TH2D*)xsec_120133bin->Clone();
 TH2D* xsecPOW_133150bin = (TH2D*)xsec_133150bin->Clone();
 //FIXME 150-171 is later subdivided into 150-160, 160-171 
 TH2D* xsecPOW_150171bin = (TH2D*)xsec_150171bin->Clone();
 TH2D* xsecPOW_171200bin = (TH2D*)xsec_171200bin->Clone();
 TH2D* xsecPOW_200400bin = (TH2D*)xsec_200400bin->Clone();

 //TH2D* mc_norm = (TH2D*)invm->Clone();

 //TFile* fPOWnormalizer = new TFile("./DATA_CP.root");
 //fPOWnormalizer->cd();
 //TH2D* ref_norm = (TH2D*)invm->Clone();

double xsec_fewz_106120[nrapbins-1][nptbins-1] = {{
0.329744, 0.0605102, 0.0189422, 0.014073, 0.0110581, 0.00883385, 0.00714777, 0.00586542, 0.00486006, 0.00406278, 0.00342141, 0.00283125, 0.00240878, 0.00211349, 0.00326965, 0.00415122, 0.00334081, 0.00289653, 0.000253297, 1.46872e-05}, {
0.32881, 0.0602872, 0.0188467, 0.0140241, 0.0110156, 0.00881446, 0.00713883, 0.00583527, 0.00485869, 0.00406428, 0.00340743, 0.00282098, 0.00240023, 0.00210492, 0.00325285, 0.00412757, 0.00333394, 0.00288928, 0.0002556, 1.14129e-05}, {
0.491808, 0.0895721, 0.0280183, 0.0207902, 0.0163858, 0.0130645, 0.0105796, 0.00864159, 0.00720052, 0.00600657, 0.00503529, 0.00418926, 0.00354843, 0.0031183, 0.00480512, 0.00608955, 0.00495032, 0.00429697, 0.000351113, 1.84026e-05}, {
0.651082, 0.116658, 0.0364328, 0.027077, 0.021345, 0.0169842, 0.0137638, 0.0111923, 0.00933402, 0.00777372, 0.00654217, 0.0054263, 0.00460879, 0.00401881, 0.00622102, 0.00793639, 0.00639064, 0.00549101, 0.000429841, 1.85962e-05}, {
1.27398, 0.218435, 0.0677807, 0.0503613, 0.0394356, 0.0314167, 0.0253842, 0.0206379, 0.0170879, 0.0141648, 0.0118446, 0.00986874, 0.00837375, 0.00727942, 0.0112383, 0.0141495, 0.0112285, 0.00906757, 0.000550101, 8.35935e-06}, {
0.752012, 0.119431, 0.0365784, 0.0268586, 0.0209856, 0.0165124, 0.0132172, 0.0106962, 0.00875015, 0.0072236, 0.00594152, 0.00492628, 0.00412393, 0.00355189, 0.00538492, 0.00655393, 0.00484763, 0.00324202, 9.10056e-05, 4.6615e-08}, {
1.23769, 0.157809, 0.0458341, 0.0326191, 0.0245679, 0.0186766, 0.0144471, 0.0113186, 0.00891199, 0.00706371, 0.00563629, 0.00449938, 0.00362101, 0.00299915, 0.00430729, 0.00470036, 0.00286513, 0.0012694, 8.51244e-06, -8.20451e-10}};

double xsec_fewz_3045[nrapbins-1][nptbins-1] = {{
3.9118, 0.354675, 0.090802, 0.0592829, 0.0413738, 0.0296388, 0.0222417, 0.0161153, 0.0118305, 0.00854286, 0.00684524, 0.00557678, 0.00431682, 0.0037262, 0.00504591, 0.00577288, 0.00393886, 0.00275568, 0.00039025, 0.000107139}, {
3.90826, 0.35407, 0.090768, 0.0595257, 0.041456, 0.0298287, 0.0221382, 0.0159619, 0.0120032, 0.00884638, 0.00685575, 0.0053909, 0.00442263, 0.00372584, 0.00530733, 0.00583533, 0.00420429, 0.00298152, 0.00050419, 0.000179765}, {
5.85899, 0.527499, 0.134506, 0.0882055, 0.0615711, 0.0439376, 0.0329127, 0.023442, 0.0177134, 0.0130643, 0.0101405, 0.00837744, 0.0066089, 0.00547625, 0.00768765, 0.00863419, 0.00590209, 0.00392418, 0.000505326, 0.00023439}, {
7.79945, 0.692843, 0.176677, 0.116029, 0.0806675, 0.0579349, 0.0426241, 0.031282, 0.0233331, 0.0173005, 0.0135577, 0.0108448, 0.00884313, 0.00726748, 0.0101969, 0.0111919, 0.00789787, 0.00557726, 0.000435897, 0.000161933}, {
15.5295, 1.33202, 0.339095, 0.222926, 0.155369, 0.11132, 0.0823176, 0.0600626, 0.045118, 0.0337357, 0.0261988, 0.0211614, 0.0166036, 0.0136092, 0.0193592, 0.0217817, 0.0144975, 0.00995049, 0.00061533, 9.1236e-05}, {
9.68756, 0.785246, 0.200736, 0.131937, 0.0918909, 0.065561, 0.0483849, 0.0361225, 0.0260742, 0.0196721, 0.0151712, 0.0120426, 0.00923063, 0.00754068, 0.0107562, 0.0118623, 0.00764567, 0.00440938, 0.000168193, -1.48074e-06}, {
38.8006, 2.19192, 0.504819, 0.312289, 0.205526, 0.137865, 0.0949647, 0.0657468, 0.0469626, 0.0336568, 0.0245283, 0.0183966, 0.0135211, 0.0102657, 0.0135924, 0.0127685, 0.00638204, 0.00229579, 5.2712e-06, 4.14961e-09}};

double xsec_fewz_4560[nrapbins-1][nptbins-1] = {{
1.19094, 0.138923, 0.0390497, 0.0269862, 0.0198041, 0.0147259, 0.0111459, 0.00848584, 0.00659854, 0.00514911, 0.0042418, 0.00336871, 0.00262837, 0.00212647, 0.00304712, 0.00356201, 0.00254061, 0.00190012, 0.00018183, 3.31633e-05}, {
1.19311, 0.138564, 0.0389645, 0.0269536, 0.0197521, 0.0147366, 0.0110729, 0.00849196, 0.00657314, 0.00522537, 0.00422657, 0.00334944, 0.0026767, 0.00215736, 0.00303848, 0.00359375, 0.00256616, 0.0018837, 0.000211565, 3.44427e-05}, {
1.78492, 0.206372, 0.0580219, 0.0400636, 0.0293936, 0.0218507, 0.0164756, 0.0126363, 0.00973813, 0.00771453, 0.00620042, 0.00501006, 0.00398948, 0.00316142, 0.00452211, 0.00534543, 0.00378825, 0.00271623, 0.000278085, 7.05767e-05}, {
2.37688, 0.270894, 0.0760465, 0.0525805, 0.0386182, 0.0286222, 0.0216174, 0.016542, 0.0128325, 0.0100594, 0.00822127, 0.00660282, 0.00514078, 0.00417313, 0.00599198, 0.00704933, 0.00504496, 0.0036191, 0.000296625, 6.90176e-05}, {
4.74724, 0.521218, 0.145745, 0.10069, 0.0738348, 0.0548108, 0.0414956, 0.0318068, 0.0245848, 0.0193437, 0.0154785, 0.0124502, 0.0097996, 0.00803188, 0.0116413, 0.0132973, 0.00923263, 0.00587283, 7.40509e-05, -1.12677e-05}, {
2.96546, 0.306598, 0.0856687, 0.0590188, 0.0430519, 0.0319686, 0.0240791, 0.0183238, 0.0142203, 0.0110697, 0.00880746, 0.00708749, 0.00565067, 0.0045488, 0.00648684, 0.00718999, 0.00471621, 0.00278839, 6.53962e-05, -6.71479e-07}, {
9.71525, 0.740462, 0.189306, 0.124042, 0.0858929, 0.0605134, 0.0432737, 0.0312363, 0.0228996, 0.0170018, 0.0126386, 0.0096434, 0.00735241, 0.00565775, 0.0075442, 0.0073132, 0.00381403, 0.00141372, 8.13785e-06, 1.37099e-09}};

double xsec_fewz_6072[nrapbins-1][nptbins-1] = {{
0.671926, 0.0809743, 0.0237668, 0.0170137, 0.01287, 0.00964009, 0.00745045, 0.00589274, 0.00458622, 0.00364139, 0.002926, 0.00235334, 0.00192741, 0.00160396, 0.00239068, 0.00267366, 0.00189881, 0.00140753, 0.000106162, 1.74747e-05}, {
0.597857, 0.0808073, 0.0236334, 0.0169896, 0.0128198, 0.00978723, 0.00756178, 0.00594891, 0.00475102, 0.00374523, 0.00302454, 0.00248939, 0.00202796, 0.00170932, 0.00254976, 0.00289513, 0.0020795, 0.00162832, 0.000139086, 1.28203e-05}, {
0.896409, 0.120211, 0.0351759, 0.0252285, 0.0190915, 0.0144783, 0.0112004, 0.00881593, 0.00701667, 0.00559344, 0.00450851, 0.00363889, 0.00300262, 0.00252551, 0.00376044, 0.00430404, 0.00311573, 0.00238357, 0.000191994, 2.62298e-05}, {
1.33229, 0.156639, 0.0459735, 0.0328358, 0.0246794, 0.018744, 0.0144975, 0.0113901, 0.00894412, 0.00709244, 0.0056988, 0.00463053, 0.00377853, 0.0031559, 0.00468476, 0.00530912, 0.0037935, 0.00273491, 0.00018669, 2.22585e-05}, {
2.3111, 0.462815, 0.119212, 0.0804473, 0.0581531, 0.042903, 0.0322871, 0.0247965, 0.0195873, 0.015327, 0.0123831, 0.0098659, 0.0081063, 0.00684536, 0.00976059, 0.0114337, 0.00806507, 0.00629114, 0.00047647, -2.18434e-06}, {
1.45406, 0.173115, 0.0500784, 0.0356753, 0.0265773, 0.020265, 0.0156342, 0.0121568, 0.00954803, 0.00760957, 0.00609933, 0.00487444, 0.00398286, 0.00328784, 0.00480849, 0.00538248, 0.00366116, 0.00218482, 5.53206e-05, 3.94616e-07}, {
3.89735, 0.354152, 0.095412, 0.064654, 0.0461201, 0.033542, 0.0246338, 0.0183147, 0.0137772, 0.0103692, 0.00794315, 0.00606512, 0.00469595, 0.00373024, 0.00506043, 0.00508285, 0.00271624, 0.00104407, 5.72822e-06, -1.52144e-11}};

double xsec_fewz_1520[nrapbins-1][nptbins-1] = {{
17.2193, 0.745756, 0.150472, 0.0904932, 0.0590407, 0.040159, 0.0277411, 0.0200186, 0.0149028, 0.0119996, 0.00894907, 0.00691936, 0.00598441, 0.0049606, 0.00651557, 0.00670307, 0.00524249, 0.00389722, 0.000824211, 0.000420909}, {
17.2688, 0.743636, 0.149995, 0.0916126, 0.0585284, 0.0405357, 0.028338, 0.0202299, 0.014845, 0.0117254, 0.00909409, 0.00780435, 0.00605558, 0.00506222, 0.00752904, 0.00812359, 0.00554766, 0.004521, 0.000955168, 0.00103115}, {
25.8091, 1.10532, 0.223608, 0.135286, 0.0866047, 0.0587496, 0.0419821, 0.0296667, 0.0220049, 0.0172371, 0.0137692, 0.0095812, 0.00830064, 0.00601639, 0.0102743, 0.0101349, 0.00650519, 0.005663, 0.00155385, 0.000818696}, {
34.3434, 1.45579, 0.294205, 0.176804, 0.114746, 0.0788574, 0.0542079, 0.0394708, 0.0286043, 0.0231649, 0.0176545, 0.0130606, 0.011505, 0.00920908, 0.0129704, 0.0122561, 0.00912764, 0.00767672, 0.00192699, 0.000995773}, {
68.3071, 2.79471, 0.569735, 0.342094, 0.222178, 0.148814, 0.103832, 0.0752696, 0.0547661, 0.0414526, 0.0316991, 0.025681, 0.0204617, 0.0175968, 0.021492, 0.0228487, 0.0156761, 0.0101617, 0.000637505, 0.000485478}, {
42.3722, 1.66075, 0.339008, 0.203146, 0.132081, 0.090058, 0.0630912, 0.0445071, 0.0333562, 0.0249044, 0.0200455, 0.0137194, 0.0113009, 0.0100078, 0.0125463, 0.0127271, 0.00818331, 0.00435493, 0.000587145, 2.91108e-05}, {
224.081, 5.4419, 0.988735, 0.548887, 0.332116, 0.208809, 0.136648, 0.089879, 0.0633729, 0.0447662, 0.0314942, 0.0227653, 0.0172396, 0.0127788, 0.0159703, 0.0148005, 0.00804421, 0.00270726, 4.87506e-05, -1.22591e-09}};

double xsec_fewz_2030[nrapbins-1][nptbins-1] = {{
10.798, 0.680898, 0.154244, 0.0945295, 0.0617133, 0.0425879, 0.0304534, 0.0218524, 0.0166738, 0.0124496, 0.00982173, 0.00776553, 0.00626594, 0.00517457, 0.00669102, 0.00734152, 0.0048912, 0.00352629, 0.000566914, 0.000328834}, {
10.7892, 0.679451, 0.153905, 0.0953557, 0.06206, 0.0421461, 0.0302208, 0.0221834, 0.0161715, 0.0129813, 0.00981358, 0.00774223, 0.00644211, 0.00527537, 0.00652315, 0.00757105, 0.00532029, 0.00383329, 0.000783385, 0.000482214}, {
16.1798, 1.01144, 0.229058, 0.141485, 0.0918843, 0.0635512, 0.0451457, 0.0329328, 0.0245382, 0.0188836, 0.0143239, 0.0111027, 0.00929683, 0.00722547, 0.0104495, 0.0109158, 0.00779306, 0.00536254, 0.000685087, 0.000679365}, {
21.5468, 1.32796, 0.300228, 0.186656, 0.120307, 0.0821762, 0.0596248, 0.042852, 0.0319374, 0.0245834, 0.0192499, 0.0147779, 0.0117878, 0.00992847, 0.0132033, 0.0139621, 0.00949267, 0.00663352, 0.00138677, 0.000466985}, {
42.7894, 2.55317, 0.576006, 0.356667, 0.235046, 0.159983, 0.114644, 0.0837493, 0.0615934, 0.0469702, 0.0352998, 0.0282449, 0.0223641, 0.0190043, 0.0246131, 0.0264322, 0.0178509, 0.0118588, 0.00046381, 0.000236081}, {
26.5644, 1.50827, 0.340909, 0.212953, 0.139798, 0.0941427, 0.06771, 0.0496065, 0.0362037, 0.0273305, 0.0207755, 0.0164544, 0.0132731, 0.0100751, 0.0141781, 0.015047, 0.00948914, 0.00475403, 0.000443353, -1.69793e-06}, {
125.65, 4.66025, 0.937401, 0.544782, 0.339724, 0.218967, 0.143989, 0.0981278, 0.0682955, 0.0481448, 0.0347481, 0.0252946, 0.0188494, 0.0138535, 0.0181668, 0.0167722, 0.00842424, 0.00295578, 4.91313e-05, -6.71701e-09}};

double xsec_fewz_72106[nrapbins-1][nptbins-1] = {{
26.4106, 4.40064, 1.34499, 0.987491, 0.766383, 0.601469, 0.481385, 0.389998, 0.313751, 0.258505, 0.21201, 0.180577, 0.14915, 0.128291, 0.194032, 0.234897, 0.183962, 0.145226, 0.011993, 0.00106683}, {
26.2326, 4.38518, 1.34041, 0.981934, 0.761656, 0.602831, 0.480166, 0.389759, 0.311329, 0.256524, 0.213746, 0.177249, 0.14812, 0.127152, 0.193729, 0.234531, 0.182997, 0.145255, 0.0119473, 0.000429632}, {
39.4557, 6.50425, 1.98957, 1.45921, 1.12851, 0.886526, 0.713189, 0.577758, 0.464581, 0.378558, 0.314099, 0.26214, 0.220086, 0.188314, 0.283602, 0.348677, 0.27077, 0.213416, 0.0177051, 0.000989193}, {
51.9005, 8.44063, 2.57826, 1.8926, 1.4645, 1.15263, 0.911099, 0.746568, 0.596218, 0.492672, 0.405129, 0.34067, 0.282475, 0.242491, 0.367046, 0.448768, 0.347213, 0.273051, 0.0208519, 0.00124871}, {
101.351, 15.7349, 4.77609, 3.49632, 2.69927, 2.11855, 1.68539, 1.36084, 1.09256, 0.894876, 0.73715, 0.607961, 0.510301, 0.434981, 0.658729, 0.797883, 0.60516, 0.454421, 0.0261792, 0.000451104}, {
60.2902, 8.63218, 2.5904, 1.87935, 1.43973, 1.12534, 0.887864, 0.710114, 0.562823, 0.459258, 0.373673, 0.306844, 0.254075, 0.214405, 0.319193, 0.373426, 0.265266, 0.164849, 0.004149, 9.47638e-06}, {
116.501, 13.2771, 3.74937, 2.62343, 1.93152, 1.44902, 1.1017, 0.845405, 0.650587, 0.505327, 0.396631, 0.313237, 0.247268, 0.20117, 0.281545, 0.294741, 0.16989, 0.0696018, 0.000413496, 6.20875e-09}};

double xsec_fewz_120133[nrapbins-1][nptbins-1] = {{
0.107747, 0.0232064, 0.0068936, 0.00504535, 0.00389723, 0.00310798, 0.00251461, 0.00206761, 0.00170702, 0.00143069, 0.00121293, 0.00103658, 0.000882672, 0.000760743, 0.00119875, 0.00155872, 0.0013055, 0.00120009, 0.00011882, 6.3019e-06}, {
0.110306, 0.0209212, 0.00664357, 0.00497814, 0.00391534, 0.00317023, 0.00256838, 0.00212743, 0.0017644, 0.00149771, 0.0012724, 0.00108689, 0.000923199, 0.000801882, 0.00125323, 0.00163328, 0.00136134, 0.0012339, 0.00011461, 4.67662e-06}, {
0.169677, 0.027599, 0.00905364, 0.00688363, 0.00549028, 0.00445749, 0.00367054, 0.00305386, 0.00255248, 0.00216602, 0.00185873, 0.00159176, 0.00135929, 0.00118606, 0.00186787, 0.00245165, 0.00206132, 0.00185844, 0.000150029, 2.14498e-06}, {
0.217203, 0.0406075, 0.0128638, 0.00965134, 0.00759673, 0.00613446, 0.00497656, 0.00410464, 0.00341863, 0.00287139, 0.0024466, 0.00207995, 0.00177141, 0.00154357, 0.00241204, 0.00313258, 0.00261987, 0.00234821, 0.000196658, 6.47939e-06}, {
0.426335, 0.0764462, 0.0240581, 0.017979, 0.0141373, 0.0113825, 0.00923282, 0.00760277, 0.00630723, 0.00528274, 0.00447181, 0.00378861, 0.00321847, 0.00278375, 0.00437848, 0.0056327, 0.00460501, 0.00392795, 0.00025221, 3.52495e-06}, {
0.251353, 0.0416615, 0.0128975, 0.00958526, 0.00746779, 0.00596393, 0.00478918, 0.00390572, 0.00321015, 0.00268281, 0.00223299, 0.00188716, 0.00156041, 0.00135529, 0.00208427, 0.00258368, 0.00197843, 0.00138436, 4.25409e-05, 6.07856e-08}, {
0.372304, 0.0499322, 0.0147153, 0.0105853, 0.00798198, 0.00614597, 0.00480178, 0.00378045, 0.00301881, 0.00241666, 0.00194762, 0.00157745, 0.00126597, 0.00106036, 0.0015508, 0.00173125, 0.00109707, 0.000507985, 3.59421e-06, -3.85666e-11}};

double xsec_fewz_133150[nrapbins-1][nptbins-1] = {{
0.0686043, 0.0137255, 0.00439838, 0.00332744, 0.00264379, 0.00212893, 0.00175455, 0.00144804, 0.00121202, 0.00102532, 0.00086998, 0.000746334, 0.000651605, 0.000576183, 0.000898782, 0.00118791, 0.00102456, 0.000979442, 9.53822e-05, 4.31525e-06}, {
0.0686471, 0.0136918, 0.00439388, 0.00334082, 0.00264414, 0.00210941, 0.00174421, 0.00145202, 0.00120518, 0.00102604, 0.000865474, 0.000756034, 0.000653448, 0.000572745, 0.000898382, 0.00118623, 0.00102268, 0.000975102, 9.58173e-05, 3.50788e-06}, {
0.102747, 0.0203663, 0.00652637, 0.00494122, 0.00391174, 0.00316067, 0.00260584, 0.00213838, 0.0018019, 0.00151771, 0.00129556, 0.00111147, 0.000963466, 0.000854113, 0.00132745, 0.00176099, 0.00151435, 0.00144927, 0.000137578, 5.32503e-06}, {
0.136597, 0.0266755, 0.0085496, 0.00644656, 0.0051207, 0.00411277, 0.00339331, 0.00280865, 0.00235219, 0.00198341, 0.00167872, 0.00145566, 0.00125512, 0.00111087, 0.00173634, 0.00229109, 0.00196808, 0.00186046, 0.000165608, 5.76971e-06}, {
0.268584, 0.0491503, 0.016597, 0.0127123, 0.0102035, 0.00829204, 0.00683177, 0.00568473, 0.00475747, 0.00400786, 0.00338423, 0.00290647, 0.00248647, 0.00219243, 0.0034354, 0.0044881, 0.00375028, 0.00329954, 0.000230507, 3.77874e-06}, {
0.158048, 0.0272834, 0.00852735, 0.00635133, 0.00500485, 0.00397774, 0.00323432, 0.00264585, 0.00218517, 0.00181956, 0.00153103, 0.00130298, 0.00109836, 0.000963691, 0.00147063, 0.00186315, 0.00146498, 0.00106655, 3.51435e-05, 1.16388e-07}, {
0.209463, 0.0293085, 0.00873191, 0.00632256, 0.00481691, 0.00373083, 0.00293022, 0.00232643, 0.00186204, 0.00150791, 0.00122801, 0.000997703, 0.000818774, 0.000690583, 0.00100752, 0.00115325, 0.000754669, 0.0003659, 2.81918e-06, -9.82484e-11}};

double xsec_fewz_150171[nrapbins-1][nptbins-1] = {{
0.0408978, 0.0093035, 0.00294287, 0.00222058, 0.00176037, 0.00142629, 0.00115842, 0.000969885, 0.000809029, 0.000688228, 0.000589858, 0.000502867, 0.000436117, 0.000391125, 0.000622066, 0.000832351, 0.000738502, 0.000745957, 7.6823e-05, 3.47031e-06}, {
0.0414104, 0.00887618, 0.0028649, 0.0021824, 0.00174538, 0.00141447, 0.00115608, 0.000971213, 0.000808716, 0.000691078, 0.000591614, 0.000510845, 0.000442396, 0.000396719, 0.000631243, 0.000845511, 0.000753432, 0.000760265, 7.64818e-05, 2.82386e-06}, {
0.0628203, 0.0130582, 0.00421908, 0.00322593, 0.00257543, 0.00208625, 0.00171363, 0.00143767, 0.00120051, 0.00102521, 0.000878295, 0.000754404, 0.000653515, 0.000586795, 0.000934718, 0.00124965, 0.00111508, 0.00112658, 0.000114242, 4.65083e-06}, {
0.0855578, 0.0184267, 0.00576253, 0.00433621, 0.00343427, 0.00277489, 0.00227185, 0.00189019, 0.00158476, 0.00134816, 0.00114843, 0.000988683, 0.000852791, 0.000769052, 0.00122054, 0.0016355, 0.00145157, 0.00145157, 0.00013977, 4.51638e-06}, {
0.185383, 0.0231758, 0.00784892, 0.00607428, 0.00492808, 0.00406557, 0.00336932, 0.00283591, 0.00239834, 0.00205879, 0.00176956, 0.00151958, 0.00131713, 0.00118819, 0.00190013, 0.0025633, 0.00226879, 0.00217565, 0.00016394, 2.42636e-06}, {
0.095934, 0.0172341, 0.00544057, 0.00407251, 0.00322079, 0.00259656, 0.00209903, 0.00173568, 0.00143545, 0.00120417, 0.00101552, 0.000861612, 0.000740502, 0.000648349, 0.00101031, 0.00129489, 0.00104772, 0.000800989, 2.76927e-05, 4.60648e-08}, {
0.110124, 0.0160659, 0.00484222, 0.0035288, 0.00271303, 0.00211398, 0.0016764, 0.00133587, 0.00108044, 0.000873862, 0.000715963, 0.000590061, 0.000488059, 0.000413836, 0.000615327, 0.000716202, 0.000485831, 0.000248865, 2.01795e-06, 1.64614e-11}};

double xsec_fewz_171200[nrapbins-1][nptbins-1] = {{
0.0307566, 0.00578759, 0.00196575, 0.00152802, 0.00124594, 0.00102742, 0.000857579, 0.000723525, 0.000611654, 0.000525366, 0.000450333, 0.000391755, 0.000342656, 0.000307793, 0.000496124, 0.000686219, 0.000626495, 0.00067078, 7.45623e-05, 3.08932e-06}, {
0.0280915, 0.00618039, 0.00202601, 0.00154784, 0.00125405, 0.00102463, 0.000848048, 0.000714789, 0.000597524, 0.00051579, 0.000437439, 0.000380834, 0.000332839, 0.000297586, 0.000481607, 0.00066365, 0.000607419, 0.000658633, 7.5526e-05, 3.09535e-06}, {
0.0421751, 0.00921325, 0.0030194, 0.00230894, 0.00186831, 0.00152166, 0.00126259, 0.00106121, 0.000891168, 0.000765875, 0.000652537, 0.000566246, 0.000492708, 0.000445723, 0.000716777, 0.000987677, 0.000905168, 0.000977589, 0.000109191, 4.55448e-06}, {
0.0563648, 0.0121583, 0.00396722, 0.00304085, 0.00244402, 0.00199601, 0.00165617, 0.00139025, 0.00117103, 0.00100492, 0.000854175, 0.000745055, 0.000648227, 0.00057929, 0.000939757, 0.00129066, 0.00117865, 0.0012588, 0.000133906, 4.41907e-06}, {
0.111376, 0.0230029, 0.00745461, 0.00568691, 0.00455243, 0.00371257, 0.00306639, 0.0025755, 0.00215444, 0.00184183, 0.00157188, 0.00136234, 0.00117725, 0.00104944, 0.00169201, 0.00230119, 0.00205978, 0.00205345, 0.000168587, 2.83435e-06}, {
0.0625983, 0.0117816, 0.0037458, 0.00283067, 0.0022408, 0.00181009, 0.00148738, 0.00122887, 0.00101901, 0.000861404, 0.000727427, 0.000619251, 0.000532834, 0.000469483, 0.000744034, 0.000969899, 0.000805919, 0.000652317, 2.43109e-05, 4.88666e-08}, {
0.0596926, 0.00909604, 0.00276908, 0.0020331, 0.00157464, 0.00123518, 0.000984997, 0.000791633, 0.000642005, 0.000524478, 0.000435059, 0.000356827, 0.000296987, 0.000256042, 0.000384783, 0.000458451, 0.000321892, 0.000175791, 1.5727e-06, 4.86506e-12}};


double xsec_fewz_200400[nrapbins-1][nptbins-1] = {{
0.0333763, 0.00810574, 0.00271257, 0.00209635, 0.00171065, 0.00141752, 0.00118848, 0.00100703, 0.000862961, 0.000741769, 0.000642577, 0.000567993, 0.000499656, 0.000448119, 0.000735487, 0.00104239, 0.0010159, 0.0012634, 0.000191465, 9.94009e-06}, {
0.033421, 0.00811575, 0.00270943, 0.00209507, 0.00170277, 0.00141611, 0.001191, 0.00101092, 0.000863328, 0.000740364, 0.000647783, 0.000565868, 0.000499848, 0.00044559, 0.000732164, 0.00104088, 0.00101057, 0.00125958, 0.000188845, 9.93613e-06}, {
0.0502176, 0.012129, 0.00404833, 0.00313144, 0.00254407, 0.00211941, 0.00177889, 0.0015057, 0.00128184, 0.00110489, 0.000958887, 0.000843351, 0.000742266, 0.000669664, 0.00109631, 0.00155411, 0.00150955, 0.00187081, 0.000275643, 1.34114e-05}, {
0.0672711, 0.0160194, 0.00533614, 0.00412038, 0.00335377, 0.00278023, 0.00232998, 0.00196373, 0.0016816, 0.00143917, 0.00125912, 0.00109865, 0.000969532, 0.000866306, 0.00143106, 0.00202727, 0.00196133, 0.00239548, 0.000330589, 1.36093e-05}, {
0.130391, 0.0294117, 0.00970941, 0.00746817, 0.00606023, 0.00498244, 0.00416299, 0.00349713, 0.00298102, 0.00255826, 0.00220937, 0.00192799, 0.00168629, 0.00151723, 0.00246584, 0.00346011, 0.00326462, 0.00367674, 0.000384533, 7.98014e-06}, {
0.0647488, 0.0128369, 0.00415574, 0.0031473, 0.00250972, 0.0020456, 0.00168669, 0.00140105, 0.0011806, 0.000998567, 0.000853783, 0.000733767, 0.000631169, 0.0005584, 0.000895818, 0.00119752, 0.00104264, 0.000932518, 4.28635e-05, 8.38917e-08}, {
0.0394891, 0.00616521, 0.00190673, 0.00140836, 0.00109515, 0.000868878, 0.000697689, 0.000566551, 0.000462369, 0.000383008, 0.000318679, 0.000265706, 0.000221689, 0.000190856, 0.000294637, 0.000361478, 0.000267319, 0.000159967, 1.67198e-06, -3.16642e-12}};

double xsec_fewz_4001500[nrapbins-1][nptbins-1] = {{
0.00871597, 0.00232521, 0.00079256, 0.000620421, 0.000510363, 0.000430446, 0.000363916, 0.000311235, 0.000270019, 0.000236765, 0.000208915, 0.000183983, 0.000163123, 0.000149215, 0.000247096, 0.000362535, 0.000372957, 0.000535351, 0.000112167, 8.33839e-06}, {
0.00873194, 0.00232082, 0.000789223, 0.000620776, 0.000510837, 0.000428895, 0.000363371, 0.000311352, 0.000270722, 0.000236403, 0.000208055, 0.000183804, 0.000163944, 0.000148606, 0.000246658, 0.000361463, 0.000372056, 0.000532136, 0.000110509, 8.06329e-06}, {
0.0131337, 0.00346511, 0.00117822, 0.000924591, 0.000761571, 0.000636196, 0.000540517, 0.000463133, 0.000401145, 0.00035138, 0.000309081, 0.000272751, 0.000240573, 0.000219387, 0.000365806, 0.000536348, 0.000549414, 0.000781831, 0.000157905, 1.05645e-05}, {
0.0174176, 0.00449614, 0.00152447, 0.00119269, 0.000982143, 0.000819908, 0.000693422, 0.000596408, 0.000513134, 0.000447915, 0.000392649, 0.000346205, 0.00030507, 0.000279086, 0.000465293, 0.000678504, 0.000690824, 0.000960557, 0.000178366, 9.63218e-06}, {
0.030568, 0.00717023, 0.00240256, 0.00186934, 0.00152774, 0.00126879, 0.00106225, 0.000905994, 0.00077545, 0.000673217, 0.000586687, 0.000513929, 0.000453689, 0.000411426, 0.000681097, 0.00097469, 0.00096021, 0.00121576, 0.00016635, 4.55087e-06}, {
0.0104283, 0.00197572, 0.000645824, 0.000491452, 0.000394345, 0.000323221, 0.000266844, 0.000223806, 0.000189392, 0.000161306, 0.000138205, 0.000119317, 0.000103738, 9.26272e-05, 0.000149114, 0.000203685, 0.00018305, 0.000179094, 1.00923e-05, 1.95522e-08}, {
0.00251038, 0.000359677, 0.000112319, 8.34902e-05, 6.54814e-05, 5.19493e-05, 4.21156e-05, 3.44659e-05, 2.83836e-05, 2.35497e-05, 1.97247e-05, 1.65466e-05, 1.39985e-05, 1.21659e-05, 1.88778e-05, 2.37533e-05, 1.83242e-05, 1.19068e-05, 1.35842e-07, 9.89881e-15}};



 //Fill histogram with above FEWZ cross sections
 TH2D* xsecFEW_1520bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_1520bin->SetName("xsecFEW_1520bin");
 TH2D* xsecFEW_2030bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_2030bin->SetName("xsecFEW_2030bin");
 TH2D* xsecFEW_4001500bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_4001500bin->SetName("xsecFEW_4001500bin");
 TH2D* xsecFEW_72106bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_72106bin->SetName("xsecFEW_72106bin");
 TH2D* xsecFEW_3045bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_3045bin->SetName("xsecFEW_3045bin");
 TH2D* xsecFEW_4560bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_4560bin->SetName("xsecFEW_4560bin");
 TH2D* xsecFEW_6072bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_6072bin->SetName("xsecFEW_6072bin");
 TH2D* xsecFEW_106120bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_106120bin->SetName("xsecFEW_106120bin");
 TH2D* xsecFEW_120133bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_120133bin->SetName("xsecFEW_120133bin");
 TH2D* xsecFEW_133150bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_133150bin->SetName("xsecFEW_133150bin");
 TH2D* xsecFEW_150171bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_150171bin->SetName("xsecFEW_150171bin");
 TH2D* xsecFEW_171200bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_171200bin->SetName("xsecFEW_171200bin");
 TH2D* xsecFEW_200400bin = (TH2D*)xsecPOW_72106bin->Clone();
 xsecFEW_200400bin->SetName("xsecFEW_200400bin");


 double POWHEG_norm = 1; //xsecPOW_72106bin->Integral();

 //cout << xsecPOW_72106bin->GetXaxis()->GetNbins() << " " << xsecPOW_72106bin->GetYaxis()->GetNbins()  << endl;

 for (int ix = 0; ix < xsecPOW_72106bin->GetXaxis()->GetNbins(); ix++) {
   for (int iy = 0; iy < xsecPOW_72106bin->GetYaxis()->GetNbins(); iy++) {
     xsecFEW_72106bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_72106[ix][iy]);///FEWZ_norm);
     xsecFEW_72106bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_1520bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_1520[ix][iy]);///FEWZ_norm);
     xsecFEW_1520bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_2030bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_2030[ix][iy]);///FEWZ_norm);
     xsecFEW_2030bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_4001500bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_4001500[ix][iy]);///FEWZ_norm);
     xsecFEW_4001500bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_3045bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_3045[ix][iy]);///FEWZ_norm);
     xsecFEW_3045bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_4560bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_4560[ix][iy]);///FEWZ_norm);
     xsecFEW_4560bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_6072bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_6072[ix][iy]);///FEWZ_norm);
     xsecFEW_6072bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_106120bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_106120[ix][iy]);///FEWZ_norm);
     xsecFEW_106120bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_120133bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_120133[ix][iy]);///FEWZ_norm);
     xsecFEW_120133bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_133150bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_133150[ix][iy]);///FEWZ_norm);
     xsecFEW_133150bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_150171bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_150171[ix][iy]);///FEWZ_norm);
     xsecFEW_150171bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_171200bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_171200[ix][iy]);///FEWZ_norm);
     xsecFEW_171200bin->SetBinError(ix+1,iy+1,0.000000001);

     xsecFEW_200400bin->SetBinContent(ix+1,iy+1,2.*xsec_fewz_200400[ix][iy]);///FEWZ_norm);
     xsecFEW_200400bin->SetBinError(ix+1,iy+1,0.000000001);

   }
 }
 
 cout << "Before reweight (should be different) " << xsecPOW_72106bin->Integral() << " " << xsecFEW_72106bin->Integral()<< endl;
 
 //remove negatives 
 filterNegatives(xsecFEW_72106bin);
 filterNegatives(xsecFEW_1520bin);
 filterNegatives(xsecFEW_2030bin);
 filterNegatives(xsecFEW_4001500bin);
 filterNegatives(xsecFEW_3045bin);
 filterNegatives(xsecFEW_4560bin);
 filterNegatives(xsecFEW_6072bin);
 filterNegatives(xsecFEW_106120bin);
 filterNegatives(xsecFEW_120133bin);
 filterNegatives(xsecFEW_133150bin);
 filterNegatives(xsecFEW_150171bin);
 filterNegatives(xsecFEW_171200bin);
 filterNegatives(xsecFEW_200400bin);

 gStyle->SetPalette(1);
 plotCOLZ(xsecPOW_72106bin);
 plotCOLZ(xsecPOW_1520bin);
 plotCOLZ(xsecPOW_2030bin);
 plotCOLZ(xsecPOW_4001500bin);
 plotCOLZ(xsecPOW_3045bin);
 plotCOLZ(xsecPOW_4560bin);
 plotCOLZ(xsecPOW_6072bin);
 plotCOLZ(xsecPOW_106120bin);
 plotCOLZ(xsecFEW_72106bin);
 plotCOLZ(xsecFEW_1520bin);
 plotCOLZ(xsecFEW_2030bin);
 plotCOLZ(xsecFEW_4001500bin);
 plotCOLZ(xsecFEW_3045bin);
 plotCOLZ(xsecFEW_4560bin);
 plotCOLZ(xsecFEW_6072bin);
 plotCOLZ(xsecFEW_106120bin);
 plotCOLZ(xsecFEW_120133bin);
 plotCOLZ(xsecFEW_133150bin);
 plotCOLZ(xsecFEW_150171bin);
 plotCOLZ(xsecFEW_171200bin);
 plotCOLZ(xsecFEW_200400bin);


 TH2D* weight72106 = (TH2D*)xsecFEW_72106bin->Clone();
 weight72106->Divide(weight72106,xsecPOW_72106bin);
 weight72106->SetName("weights_fewz_72106");

 TH2D* weight1520 = (TH2D*)xsecFEW_1520bin->Clone();
 weight1520->Divide(weight1520,xsecPOW_1520bin);
 weight1520->SetName("weights_fewz_1520");

 TH2D* weight2030 = (TH2D*)xsecFEW_2030bin->Clone();
 weight2030->Divide(weight2030,xsecPOW_2030bin);
 weight2030->SetName("weights_fewz_2030");

 TH2D* weight4001500 = (TH2D*)xsecFEW_4001500bin->Clone();
 weight4001500->Divide(weight4001500,xsecPOW_4001500bin);
 weight4001500->SetName("weights_fewz_4001500");

 TH2D* weight3045 = (TH2D*)xsecFEW_3045bin->Clone();
 weight3045->Divide(weight3045,xsecPOW_3045bin);
 weight3045->SetName("weights_fewz_3045");

 TH2D* weight4560 = (TH2D*)xsecFEW_4560bin->Clone();
 weight4560->Divide(weight4560,xsecPOW_4560bin);
 weight4560->SetName("weights_fewz_4560");

 TH2D* weight6072 = (TH2D*)xsecFEW_6072bin->Clone();
 weight6072->Divide(weight6072,xsecPOW_6072bin);
 weight6072->SetName("weights_fewz_6072");

 TH2D* weight106120 = (TH2D*)xsecFEW_106120bin->Clone();
 weight106120->Divide(weight106120,xsecPOW_106120bin);
 weight106120->SetName("weights_fewz_106120");

 TH2D* weight120133 = (TH2D*)xsecFEW_120133bin->Clone();
 weight120133->Divide(weight120133,xsecPOW_120133bin);
 weight120133->SetName("weights_fewz_120133");

 TH2D* weight133150 = (TH2D*)xsecFEW_133150bin->Clone();
 weight133150->Divide(weight133150,xsecPOW_133150bin);
 weight133150->SetName("weights_fewz_133150");

 TH2D* weight150171 = (TH2D*)xsecFEW_150171bin->Clone();
 weight150171->Divide(weight150171,xsecPOW_150171bin);
 weight150171->SetName("weights_fewz_150171");

 TH2D* weight171200 = (TH2D*)xsecFEW_171200bin->Clone();
 weight171200->Divide(weight171200,xsecPOW_171200bin);
 weight171200->SetName("weights_fewz_171200");

 TH2D* weight200400 = (TH2D*)xsecFEW_200400bin->Clone();
 weight200400->Divide(weight200400,xsecPOW_200400bin);
 weight200400->SetName("weights_fewz_200400");






/*
 for (int ipt = 0; ipt < weight72106->GetYaxis()->GetNbins(); ipt++) {
   for (int ieta = 0; ieta < weight72106->GetXaxis()->GetNbins(); ieta++) {
     cout << weight72106->GetBinContent(ieta+1,ipt+1) << endl; 
     //if (weight72106->GetBinContent(ieta+1,ipt+1) > 1.5) weight72106->SetBinContent(ieta+1,ipt+1,(weight72106->GetBinContent(ieta,ipt+1)+weight72106->GetBinContent(ieta+2,ipt+1))/2.);
   }
 }
*/

 plotCOLZ(weight72106);
 plotCOLZ(weight1520);
 plotCOLZ(weight2030);
 plotCOLZ(weight4001500);
 plotCOLZ(weight3045);
 plotCOLZ(weight4560);
 plotCOLZ(weight6072);
 plotCOLZ(weight106120);
 plotCOLZ(weight120133);
 plotCOLZ(weight133150);
 plotCOLZ(weight150171);
 plotCOLZ(weight171200);
 plotCOLZ(weight200400);

 printWeightMap(weight1520);
 printWeightMap(weight2030);
 printWeightMap(weight72106);
 printWeightMap(weight4001500);
 printWeightMap(weight3045);
 printWeightMap(weight4560);
 printWeightMap(weight6072);
 printWeightMap(weight106120);
 printWeightMap(weight120133);
 printWeightMap(weight133150);
 printWeightMap(weight150171);
 printWeightMap(weight171200);
 printWeightMap(weight200400);

}

void filterNegatives(TH2D* h) {
  for (int i = 1; i < h->GetXaxis()->GetNbins(); i++) {
    for (int j = 1; j < h->GetYaxis()->GetNbins(); j++) {
      if (h->GetBinContent(i+1,j+1) < 0) 
        h->SetBinContent(i+1,j+1,(h->GetBinContent(i+1,j)+h->GetBinContent(i+1,j+2))/2.);  
    }
  } 
}

void plotCOLZ(TH2D* xsecPOW) {
     
 TCanvas* c = new TCanvas(xsecPOW->GetName(), xsecPOW->GetName());
 c->cd();
 c->SetLogy();
 c->SetLogx();
 xsecPOW->GetYaxis()->SetMoreLogLabels();
 xsecPOW->Draw("COLZ");
 //c->SaveAs(TString(xsecPOW->GetName())+".png");

}

void printWeightMap(TH2D* h_weight) {

//nptbins 21 nrapbins 8
//X 7 Y 20

   cout << "double "+TString(h_weight->GetName())+"[nrapbins-1][nptbins-1] = {{" << endl;
   for (int ieta = 0; ieta < 7; ieta++) {
      for (int ipt = 0; ipt < 20; ipt++) {
       if (ipt != 19) { //nptbins-2) {
           cout << h_weight->GetBinContent(ieta+1,ipt+1) << ", ";
         } else {
           cout << h_weight->GetBinContent(ieta+1,ipt+1);
         }
        }
        if (ieta != 6) { //nrapbins-2) {
           cout << "}, {" << endl;
        } else {
           cout << "}};" << endl;
        }
    }//x bins loop
    cout << endl;
    cout << endl;

}
